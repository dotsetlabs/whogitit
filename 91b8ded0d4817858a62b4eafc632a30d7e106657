{
  "version": 2,
  "session": {
    "session_id": "07fba917-517b-499b-ac33-64237e267092",
    "model": {
      "id": "claude-opus-4-5-20251101",
      "provider": "anthropic"
    },
    "started_at": "2026-01-31T16:59:34.026567+00:00",
    "prompt_count": 2
  },
  "prompts": [
    {
      "index": 0,
      "text": "AI-assisted code change",
      "timestamp": "2026-01-31T16:59:34.026647+00:00",
      "affected_files": [
        "src/capture/threeway.rs"
      ]
    },
    {
      "index": 1,
      "text": "AI-assisted code change",
      "timestamp": "2026-01-31T17:00:24.752101+00:00",
      "affected_files": [
        "src/capture/threeway.rs"
      ]
    }
  ],
  "files": [
    {
      "path": "src/capture/threeway.rs",
      "lines": [
        {
          "line_number": 1,
          "content": "use std::collections::{HashMap, HashSet};",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 2,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 3,
          "content": "use similar::{ChangeTag, TextDiff};",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 4,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 5,
          "content": "use crate::capture::snapshot::{",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 6,
          "content": "    FileAttributionResult, FileEditHistory, LineAttribution, LineSource,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 7,
          "content": "};",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 8,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 9,
          "content": "/// Normalize a line for comparison purposes.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 10,
          "content": "/// - Trims trailing whitespace (but preserves leading indentation)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 11,
          "content": "/// - Normalizes line endings",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 12,
          "content": "/// - Handles cross-platform line ending differences",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 13,
          "content": "fn normalize_line(line: &str) -> String {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 14,
          "content": "    line.trim_end().to_string()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 15,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 16,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 17,
          "content": "/// Normalize a line for use as a hash key.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 18,
          "content": "/// Uses the same normalization as normalize_line.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 19,
          "content": "fn normalize_for_key(line: &str) -> String {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 20,
          "content": "    normalize_line(line)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 21,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 22,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 23,
          "content": "/// Performs three-way attribution analysis",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 24,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 25,
          "content": "/// Given:",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 26,
          "content": "/// - Original content (before any AI edits)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 27,
          "content": "/// - AI edit history (sequence of AI changes)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 28,
          "content": "/// - Final content (what's being committed)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 29,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 30,
          "content": "/// Determines for each line in final content:",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 31,
          "content": "/// - Was it from the original file?",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 32,
          "content": "/// - Was it added by AI (and which edit/prompt)?",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 33,
          "content": "/// - Was it added by AI but modified by human?",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 34,
          "content": "/// - Was it added by human after AI edits?",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 35,
          "content": "pub struct ThreeWayAnalyzer;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 36,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 37,
          "content": "impl ThreeWayAnalyzer {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 38,
          "content": "    /// Analyze a file's final content against its edit history",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 39,
          "content": "    pub fn analyze(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 40,
          "content": "        history: &FileEditHistory,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 41,
          "content": "        final_content: &str,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 42,
          "content": "    ) -> FileAttributionResult {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 43,
          "content": "        let final_lines: Vec<&str> = final_content.lines().collect();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 44,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 45,
          "content": "        // Build lookup tables for efficient matching",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 46,
          "content": "        let original_lines = build_line_set(&history.original.content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 47,
          "content": "        let ai_line_sources = build_ai_line_map(history);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 48,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 49,
          "content": "        // Analyze each line in the final content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 50,
          "content": "        let mut attributions = Vec::with_capacity(final_lines.len());",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 51,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 52,
          "content": "        for (idx, line) in final_lines.iter().enumerate() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 53,
          "content": "            let line_number = (idx + 1) as u32;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 54,
          "content": "            let attribution = attribute_line(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 55,
          "content": "                line,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 56,
          "content": "                line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 57,
          "content": "                &original_lines,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 58,
          "content": "                &ai_line_sources,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 59,
          "content": "                history,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 60,
          "content": "            );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 61,
          "content": "            attributions.push(attribution);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 62,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 63,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 64,
          "content": "        // Post-process: improve attribution using context",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 65,
          "content": "        improve_attributions_with_context(&mut attributions, history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 66,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 67,
          "content": "        let summary = FileAttributionResult::compute_summary(&attributions);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 68,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 69,
          "content": "        FileAttributionResult {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 70,
          "content": "            path: history.path.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 71,
          "content": "            lines: attributions,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 72,
          "content": "            summary,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 73,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 74,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 75,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 76,
          "content": "    /// Analyze with position-aware diff for better accuracy",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 77,
          "content": "    pub fn analyze_with_diff(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 78,
          "content": "        history: &FileEditHistory,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 79,
          "content": "        final_content: &str,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 80,
          "content": "    ) -> FileAttributionResult {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 81,
          "content": "        let final_lines: Vec<&str> = final_content.lines().collect();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 82,
          "content": "        let mut attributions = Vec::with_capacity(final_lines.len());",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 83,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 84,
          "content": "        // If no AI edits, everything is original or human",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 85,
          "content": "        if history.edits.is_empty() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 86,
          "content": "            for (idx, line) in final_lines.iter().enumerate() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 87,
          "content": "                let line_number = (idx + 1) as u32;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 88,
          "content": "                let source = if line_in_content(line, &history.original.content) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 89,
          "content": "                    LineSource::Original",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 90,
          "content": "                } else {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 91,
          "content": "                    LineSource::Human",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 92,
          "content": "                };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 93,
          "content": "                attributions.push(LineAttribution {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 94,
          "content": "                    line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 95,
          "content": "                    content: line.to_string(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 96,
          "content": "                    source,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 97,
          "content": "                    edit_id: None,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 98,
          "content": "                    prompt_index: None,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 99,
          "content": "                    confidence: 1.0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 100,
          "content": "                });",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 101,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 102,
          "content": "            let summary = FileAttributionResult::compute_summary(&attributions);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 103,
          "content": "            return FileAttributionResult {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 104,
          "content": "                path: history.path.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 105,
          "content": "                lines: attributions,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 106,
          "content": "                summary,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 107,
          "content": "            };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 108,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 109,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 110,
          "content": "        // Perform diff-based analysis",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 111,
          "content": "        // Compare: original -> final, and latest_ai -> final",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 112,
          "content": "        let latest_ai = history.latest_ai_content();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 113,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 114,
          "content": "        // Track which final lines match AI content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 115,
          "content": "        let ai_to_final_mapping = diff_map_lines(&latest_ai.content, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 116,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 117,
          "content": "        // Track which final lines match original content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 118,
          "content": "        let original_to_final_mapping = diff_map_lines(&history.original.content, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 119,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 120,
          "content": "        // Build reverse map: final line index -> source",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 121,
          "content": "        let mut final_line_sources: HashMap<usize, (LineSource, Option<String>, Option<u32>)> =",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 122,
          "content": "            HashMap::new();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 123,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 124,
          "content": "        // First pass: mark lines that came from AI edits (takes priority)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 125,
          "content": "        let ai_line_map = build_ai_line_map(history);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 126,
          "content": "        for (ai_idx, final_idx) in &ai_to_final_mapping {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 127,
          "content": "            let ai_line = latest_ai.lines().get(*ai_idx).map(|s| *s).unwrap_or(\"\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 128,
          "content": "            let normalized = normalize_for_key(ai_line);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 129,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 130,
          "content": "            // Check if this line came from an AI edit",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 131,
          "content": "            if let Some((edit_id, prompt_idx)) = ai_line_map.get(&normalized) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 132,
          "content": "                final_line_sources.insert(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 133,
          "content": "                    *final_idx,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 134,
          "content": "                    (",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 135,
          "content": "                        LineSource::AI {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 136,
          "content": "                            edit_id: edit_id.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 137,
          "content": "                        },",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 138,
          "content": "                        Some(edit_id.clone()),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 139,
          "content": "                        Some(*prompt_idx),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 140,
          "content": "                    ),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 141,
          "content": "                );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 142,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 143,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 144,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 145,
          "content": "        // Second pass: mark lines that exist in original (only if not already AI)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 146,
          "content": "        for (_, final_idx) in &original_to_final_mapping {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 147,
          "content": "            if !final_line_sources.contains_key(final_idx) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 148,
          "content": "                final_line_sources.insert(*final_idx, (LineSource::Original, None, None));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 149,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 150,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 151,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 152,
          "content": "        // Third pass: check unmapped lines against AI content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 153,
          "content": "        // This is critical - the diff may not map lines even if they're identical",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 154,
          "content": "        // (e.g., when surrounding context changes, diff sees Delete+Insert instead of Equal)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 155,
          "content": "        for (idx, line) in final_lines.iter().enumerate() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 156,
          "content": "            if final_line_sources.contains_key(&idx) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 157,
          "content": "                continue;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 158,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 159,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 160,
          "content": "            let normalized = normalize_for_key(line);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 161,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 162,
          "content": "            // First check for exact match in AI map - this is the key fix!",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 163,
          "content": "            // Lines that exist verbatim in AI output should be attributed to AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 164,
          "content": "            // even if the diff algorithm didn't map them as \"Equal\"",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 165,
          "content": "            if let Some((edit_id, prompt_idx)) = ai_line_map.get(&normalized) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 166,
          "content": "                final_line_sources.insert(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 167,
          "content": "                    idx,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 168,
          "content": "                    (",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 169,
          "content": "                        LineSource::AI {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 170,
          "content": "                            edit_id: edit_id.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 171,
          "content": "                        },",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 172,
          "content": "                        Some(edit_id.clone()),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 173,
          "content": "                        Some(*prompt_idx),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 174,
          "content": "                    ),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 175,
          "content": "                );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 176,
          "content": "                continue;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 177,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 178,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 179,
          "content": "            // Check if this is similar to an AI line (modified)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 180,
          "content": "            if let Some((edit_id, prompt_idx, similarity)) =",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 181,
          "content": "                find_similar_ai_line(line, &ai_line_map, 0.6)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 182,
          "content": "            {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 183,
          "content": "                final_line_sources.insert(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 184,
          "content": "                    idx,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 185,
          "content": "                    (",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 186,
          "content": "                        LineSource::AIModified {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 187,
          "content": "                            edit_id: edit_id.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 188,
          "content": "                            similarity,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 189,
          "content": "                        },",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 190,
          "content": "                        Some(edit_id),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 191,
          "content": "                        Some(prompt_idx),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 192,
          "content": "                    ),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 193,
          "content": "                );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 194,
          "content": "                continue;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 195,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 196,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 197,
          "content": "            // Check if line exists in original (untouched by AI or human)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 198,
          "content": "            if line_in_content(line, &history.original.content) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 199,
          "content": "                final_line_sources.insert(idx, (LineSource::Original, None, None));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 200,
          "content": "                continue;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 201,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 202,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 203,
          "content": "            // New line added by human",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 204,
          "content": "            final_line_sources.insert(idx, (LineSource::Human, None, None));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 205,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 206,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 207,
          "content": "        // Build final attributions",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 208,
          "content": "        for (idx, line) in final_lines.iter().enumerate() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 209,
          "content": "            let line_number = (idx + 1) as u32;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 210,
          "content": "            let (source, edit_id, prompt_index) = final_line_sources",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 211,
          "content": "                .get(&idx)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 212,
          "content": "                .cloned()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 213,
          "content": "                .unwrap_or((LineSource::Unknown, None, None));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 214,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 215,
          "content": "            let confidence = match &source {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 216,
          "content": "                LineSource::Original => 1.0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 217,
          "content": "                LineSource::AI { .. } => 1.0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 218,
          "content": "                LineSource::AIModified { similarity, .. } => *similarity,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 219,
          "content": "                LineSource::Human => 0.9,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 220,
          "content": "                LineSource::Unknown => 0.5,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 221,
          "content": "            };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 222,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 223,
          "content": "            attributions.push(LineAttribution {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 224,
          "content": "                line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 225,
          "content": "                content: line.to_string(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 226,
          "content": "                source,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 227,
          "content": "                edit_id,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 228,
          "content": "                prompt_index,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 229,
          "content": "                confidence,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 230,
          "content": "            });",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 231,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 232,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 233,
          "content": "        let summary = FileAttributionResult::compute_summary(&attributions);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 234,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 235,
          "content": "        FileAttributionResult {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 236,
          "content": "            path: history.path.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 237,
          "content": "            lines: attributions,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 238,
          "content": "            summary,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 239,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 240,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 241,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 242,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 243,
          "content": "/// Build a set of normalized lines from content for fast lookup",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 244,
          "content": "fn build_line_set(content: &str) -> HashSet<String> {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 245,
          "content": "    content.lines().map(|l| normalize_for_key(l)).collect()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 246,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 247,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 248,
          "content": "/// Build a map from normalized line content -> (edit_id, prompt_index) for all AI edits",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 249,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 250,
          "content": "/// IMPORTANT: All lines in an AI edit's `after` content are considered AI-generated,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 251,
          "content": "/// not just lines that differ from `before`. This is because when AI writes/edits a file,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 252,
          "content": "/// it produces the entire output - even if some lines coincidentally match the original,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 253,
          "content": "/// the AI chose to include them.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 254,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 255,
          "content": "/// Lines are normalized (trailing whitespace trimmed) to handle git/editor differences.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 256,
          "content": "fn build_ai_line_map(history: &FileEditHistory) -> HashMap<String, (String, u32)> {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 257,
          "content": "    let mut map = HashMap::new();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 258,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 259,
          "content": "    // Process edits in order - later edits override earlier ones",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 260,
          "content": "    for edit in &history.edits {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 261,
          "content": "        // ALL lines in the AI's output are AI-generated",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 262,
          "content": "        // This ensures complete file rewrites are properly attributed",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 263,
          "content": "        for line in edit.after.content.lines() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 264,
          "content": "            map.insert(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 265,
          "content": "                normalize_for_key(line),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 266,
          "content": "                (edit.edit_id.clone(), edit.prompt_index),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 267,
          "content": "            );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 268,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 269,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 270,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 271,
          "content": "    map",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 272,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 273,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 274,
          "content": "/// Check if a normalized line exists in content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 275,
          "content": "fn line_in_content(line: &str, content: &str) -> bool {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 276,
          "content": "    let normalized = normalize_for_key(line);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 277,
          "content": "    content.lines().any(|l| normalize_for_key(l) == normalized)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 278,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 279,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 280,
          "content": "/// Map line indices from source to target using diff",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 281,
          "content": "fn diff_map_lines(source: &str, target: &str) -> Vec<(usize, usize)> {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 282,
          "content": "    let diff = TextDiff::from_lines(source, target);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 283,
          "content": "    let mut mappings = Vec::new();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 284,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 285,
          "content": "    let mut source_idx = 0usize;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 286,
          "content": "    let mut target_idx = 0usize;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 287,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 288,
          "content": "    for change in diff.iter_all_changes() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 289,
          "content": "        match change.tag() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 290,
          "content": "            ChangeTag::Equal => {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 291,
          "content": "                mappings.push((source_idx, target_idx));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 292,
          "content": "                source_idx += 1;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 293,
          "content": "                target_idx += 1;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 294,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 295,
          "content": "            ChangeTag::Delete => {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 296,
          "content": "                source_idx += 1;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 297,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 298,
          "content": "            ChangeTag::Insert => {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 299,
          "content": "                target_idx += 1;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 300,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 301,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 302,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 303,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 304,
          "content": "    mappings",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 305,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 306,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 307,
          "content": "/// Attribute a single line",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 308,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 309,
          "content": "/// Priority order:",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 310,
          "content": "/// 1. AI - if line is in the AI edit output, it's AI-generated",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 311,
          "content": "/// 2. AIModified - if line is similar to an AI line",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 312,
          "content": "/// 3. Original - if line existed before AI edits and wasn't touched",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 313,
          "content": "/// 4. Human - line was added after AI edits",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 314,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 315,
          "content": "/// All lookups use normalized line content to handle whitespace differences.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 316,
          "content": "fn attribute_line(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 317,
          "content": "    line: &str,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 318,
          "content": "    line_number: u32,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 319,
          "content": "    original_lines: &HashSet<String>,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 320,
          "content": "    ai_line_sources: &HashMap<String, (String, u32)>,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 321,
          "content": "    _history: &FileEditHistory,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 322,
          "content": ") -> LineAttribution {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 323,
          "content": "    let normalized = normalize_for_key(line);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 324,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 325,
          "content": "    // Check if line matches an AI edit exactly - AI takes priority",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 326,
          "content": "    // because if the AI output contains this line, it's AI-generated",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 327,
          "content": "    // (even if the same line existed in the original)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 328,
          "content": "    if let Some((edit_id, prompt_idx)) = ai_line_sources.get(&normalized) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 329,
          "content": "        return LineAttribution {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 330,
          "content": "            line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 331,
          "content": "            content: line.to_string(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 332,
          "content": "            source: LineSource::AI {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 333,
          "content": "                edit_id: edit_id.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 334,
          "content": "            },",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 335,
          "content": "            edit_id: Some(edit_id.clone()),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 336,
          "content": "            prompt_index: Some(*prompt_idx),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 337,
          "content": "            confidence: 1.0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 338,
          "content": "        };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 339,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 340,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 341,
          "content": "    // Check if line is similar to an AI line (human modified AI output)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 342,
          "content": "    if let Some((edit_id, prompt_idx, similarity)) =",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 343,
          "content": "        find_similar_ai_line(line, ai_line_sources, 0.6)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 344,
          "content": "    {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 345,
          "content": "        return LineAttribution {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 346,
          "content": "            line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 347,
          "content": "            content: line.to_string(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 348,
          "content": "            source: LineSource::AIModified {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 349,
          "content": "                edit_id: edit_id.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 350,
          "content": "                similarity,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 351,
          "content": "            },",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 352,
          "content": "            edit_id: Some(edit_id),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 353,
          "content": "            prompt_index: Some(prompt_idx),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 354,
          "content": "            confidence: similarity,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 355,
          "content": "        };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 356,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 357,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 358,
          "content": "    // Check if line existed in original (and wasn't part of AI output)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 359,
          "content": "    if original_lines.contains(&normalized) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 360,
          "content": "        return LineAttribution {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 361,
          "content": "            line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 362,
          "content": "            content: line.to_string(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 363,
          "content": "            source: LineSource::Original,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 364,
          "content": "            edit_id: None,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 365,
          "content": "            prompt_index: None,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 366,
          "content": "            confidence: 1.0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 367,
          "content": "        };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 368,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 369,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 370,
          "content": "    // Line doesn't match original or AI - it's a human addition",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 371,
          "content": "    LineAttribution {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 372,
          "content": "        line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 373,
          "content": "        content: line.to_string(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 374,
          "content": "        source: LineSource::Human,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 375,
          "content": "        edit_id: None,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 376,
          "content": "        prompt_index: None,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 377,
          "content": "        confidence: 0.9,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 378,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 379,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 380,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 381,
          "content": "/// Find a similar AI line using edit distance",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 382,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 383,
          "content": "/// Note: Empty/whitespace-only lines are handled by exact matching in attribute_line,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 384,
          "content": "/// so this function focuses on non-trivial content similarity.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 385,
          "content": "fn find_similar_ai_line(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 386,
          "content": "    line: &str,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 387,
          "content": "    ai_lines: &HashMap<String, (String, u32)>,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 388,
          "content": "    threshold: f64,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 389,
          "content": ") -> Option<(String, u32, f64)> {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 390,
          "content": "    let line_trimmed = line.trim();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 391,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 392,
          "content": "    // Empty lines should be handled by exact matching, not similarity",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 393,
          "content": "    // (empty lines match other empty lines with 100% similarity via normalize_for_key)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 394,
          "content": "    if line_trimmed.is_empty() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 395,
          "content": "        return None;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 396,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 397,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 398,
          "content": "    let mut best_match: Option<(String, u32, f64)> = None;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 399,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 400,
          "content": "    for (ai_line, (edit_id, prompt_idx)) in ai_lines {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 401,
          "content": "        let ai_trimmed = ai_line.trim();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 402,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 403,
          "content": "        // Skip empty AI lines in similarity comparison",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 404,
          "content": "        if ai_trimmed.is_empty() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 405,
          "content": "            continue;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 406,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 407,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 408,
          "content": "        let similarity = compute_similarity(line_trimmed, ai_trimmed);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 409,
          "content": "        if similarity >= threshold {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 410,
          "content": "            if best_match.is_none() || similarity > best_match.as_ref().unwrap().2 {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 411,
          "content": "                best_match = Some((edit_id.clone(), *prompt_idx, similarity));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 412,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 413,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 414,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 415,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 416,
          "content": "    best_match",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 417,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 418,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 419,
          "content": "/// Compute similarity between two strings (0.0 - 1.0)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 420,
          "content": "fn compute_similarity(a: &str, b: &str) -> f64 {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 421,
          "content": "    if a == b {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 422,
          "content": "        return 1.0;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 423,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 424,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 425,
          "content": "    if a.is_empty() || b.is_empty() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 426,
          "content": "        return 0.0;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 427,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 428,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 429,
          "content": "    // Use longest common subsequence ratio",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 430,
          "content": "    let lcs_len = longest_common_subsequence(a, b);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 431,
          "content": "    let max_len = a.len().max(b.len()) as f64;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 432,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 433,
          "content": "    lcs_len as f64 / max_len",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 434,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 435,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 436,
          "content": "/// Compute length of longest common subsequence",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 437,
          "content": "fn longest_common_subsequence(a: &str, b: &str) -> usize {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 438,
          "content": "    let a_chars: Vec<char> = a.chars().collect();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 439,
          "content": "    let b_chars: Vec<char> = b.chars().collect();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 440,
          "content": "    let m = a_chars.len();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 441,
          "content": "    let n = b_chars.len();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 442,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 443,
          "content": "    // Optimization: if strings are very different in length, quick exit",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 444,
          "content": "    if (m as f64 / n as f64) < 0.5 || (n as f64 / m as f64) < 0.5 {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 445,
          "content": "        return 0;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 446,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 447,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 448,
          "content": "    let mut dp = vec![vec![0usize; n + 1]; m + 1];",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 449,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 450,
          "content": "    for i in 1..=m {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 451,
          "content": "        for j in 1..=n {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 452,
          "content": "            if a_chars[i - 1] == b_chars[j - 1] {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 453,
          "content": "                dp[i][j] = dp[i - 1][j - 1] + 1;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 454,
          "content": "            } else {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 455,
          "content": "                dp[i][j] = dp[i - 1][j].max(dp[i][j - 1]);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 456,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 457,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 458,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 459,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 460,
          "content": "    dp[m][n]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 461,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 462,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 463,
          "content": "/// Improve attributions using contextual information",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 464,
          "content": "fn improve_attributions_with_context(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 465,
          "content": "    attributions: &mut Vec<LineAttribution>,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 466,
          "content": "    _history: &FileEditHistory,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 467,
          "content": "    _final_content: &str,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 468,
          "content": ") {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 469,
          "content": "    // If we have unknown lines surrounded by AI lines from the same edit,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 470,
          "content": "    // they might be AI lines that were modified",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 471,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 472,
          "content": "    let len = attributions.len();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 473,
          "content": "    if len < 3 {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 474,
          "content": "        return;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 475,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 476,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 477,
          "content": "    for i in 1..len - 1 {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 478,
          "content": "        if attributions[i].source == LineSource::Unknown {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 479,
          "content": "            // Check surrounding lines",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 480,
          "content": "            let prev_edit = attributions[i - 1].edit_id.clone();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 481,
          "content": "            let next_edit = attributions[i + 1].edit_id.clone();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 482,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 483,
          "content": "            if prev_edit.is_some() && prev_edit == next_edit {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 484,
          "content": "                // Likely an AI line that was modified",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 485,
          "content": "                attributions[i].source = LineSource::AIModified {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 486,
          "content": "                    edit_id: prev_edit.clone().unwrap(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 487,
          "content": "                    similarity: 0.5,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 488,
          "content": "                };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 489,
          "content": "                attributions[i].edit_id = prev_edit;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 490,
          "content": "                attributions[i].prompt_index = attributions[i - 1].prompt_index;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 491,
          "content": "                attributions[i].confidence = 0.5;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 492,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 493,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 494,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 495,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 496,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 497,
          "content": "#[cfg(test)]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 498,
          "content": "mod tests {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 499,
          "content": "    use super::*;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 500,
          "content": "    use crate::capture::snapshot::AIEdit;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 501,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 502,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 503,
          "content": "    fn test_simple_ai_addition() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 504,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(\"line1\\nline2\\n\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 505,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 506,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 507,
          "content": "            \"Add line3\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 508,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 509,
          "content": "            \"Edit\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 510,
          "content": "            \"line1\\nline2\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 511,
          "content": "            \"line1\\nline2\\nline3\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 512,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 513,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 514,
          "content": "        let result = ThreeWayAnalyzer::analyze(&history, \"line1\\nline2\\nline3\\n\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 515,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 516,
          "content": "        // All 3 lines are in the AI's output, so all 3 are AI-generated",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 517,
          "content": "        // (even though line1 and line2 also existed in original)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 518,
          "content": "        assert_eq!(result.summary.ai_lines, 3);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 519,
          "content": "        assert_eq!(result.summary.original_lines, 0);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 520,
          "content": "        assert_eq!(result.summary.human_lines, 0);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 521,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 522,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 523,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 524,
          "content": "    fn test_human_modification_after_ai() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 525,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(\"line1\\n\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 526,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 527,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 528,
          "content": "            \"Add lines\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 529,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 530,
          "content": "            \"Edit\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 531,
          "content": "            \"line1\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 532,
          "content": "            \"line1\\nAI line\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 533,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 534,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 535,
          "content": "        // Human adds a line and modifies AI line",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 536,
          "content": "        let final_content = \"line1\\nAI line modified\\nhuman line\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 537,
          "content": "        let result = ThreeWayAnalyzer::analyze(&history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 538,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 539,
          "content": "        // \"line1\" is in AI output, so it's AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 540,
          "content": "        assert_eq!(result.summary.ai_lines, 1);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 541,
          "content": "        // \"AI line modified\" should be detected as AIModified",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 542,
          "content": "        // \"human line\" should be detected as Human",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 543,
          "content": "        assert_eq!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 544,
          "content": "            result.summary.ai_modified_lines + result.summary.human_lines,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 545,
          "content": "            2,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 546,
          "content": "            \"Should have 2 non-AI lines (modified + human)\"",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 547,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 548,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 549,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 550,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 551,
          "content": "    fn test_line_shift() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 552,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(\"line1\\nline2\\n\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 553,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 554,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 555,
          "content": "            \"Add AI content\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 556,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 557,
          "content": "            \"Edit\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 558,
          "content": "            \"line1\\nline2\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 559,
          "content": "            \"line1\\nline2\\nAI added\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 560,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 561,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 562,
          "content": "        // Human inserts line at beginning",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 563,
          "content": "        let final_content = \"new first line\\nline1\\nline2\\nAI added\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 564,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 565,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 566,
          "content": "        // \"new first line\" is Human (not in AI output)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 567,
          "content": "        // \"line1\", \"line2\", \"AI added\" are all in AI output, so AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 568,
          "content": "        assert_eq!(result.summary.human_lines, 1);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 569,
          "content": "        assert_eq!(result.summary.ai_lines, 3);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 570,
          "content": "        assert_eq!(result.summary.original_lines, 0);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 571,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 572,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 573,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 574,
          "content": "    fn test_similarity_computation() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 575,
          "content": "        assert_eq!(compute_similarity(\"hello\", \"hello\"), 1.0);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 576,
          "content": "        // Completely different strings",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 577,
          "content": "        assert!(compute_similarity(\"abc\", \"xyz\") < 0.3);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 578,
          "content": "        // Similar strings with comparable length should have high similarity",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 579,
          "content": "        assert!(compute_similarity(\"println(hello)\", \"println(world)\") > 0.6);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 580,
          "content": "        // Modified line detection",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 581,
          "content": "        assert!(compute_similarity(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 582,
          "content": "            \"    println!(\\\"hello\\\");\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 583,
          "content": "            \"    println!(\\\"hello, world!\\\");\"",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 584,
          "content": "        ) > 0.6);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 585,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 586,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 587,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 588,
          "content": "    fn test_multiple_ai_edits() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 589,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(\"original\\n\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 590,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 591,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 592,
          "content": "            \"First prompt\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 593,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 594,
          "content": "            \"Edit\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 595,
          "content": "            \"original\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 596,
          "content": "            \"original\\nfirst AI\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 597,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 598,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 599,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 600,
          "content": "            \"Second prompt\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 601,
          "content": "            1,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 602,
          "content": "            \"Edit\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 603,
          "content": "            \"original\\nfirst AI\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 604,
          "content": "            \"original\\nfirst AI\\nsecond AI\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 605,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 606,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 607,
          "content": "        let result = ThreeWayAnalyzer::analyze(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 608,
          "content": "            &history,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 609,
          "content": "            \"original\\nfirst AI\\nsecond AI\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 610,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 611,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 612,
          "content": "        // All lines are in the AI output from the second edit",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 613,
          "content": "        // \"original\" gets attributed to edit 1 (first appearance in AI output)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 614,
          "content": "        // \"first AI\" gets attributed to edit 0 (first added)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 615,
          "content": "        // \"second AI\" gets attributed to edit 1 (first added)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 616,
          "content": "        assert_eq!(result.summary.ai_lines, 3);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 617,
          "content": "        assert_eq!(result.summary.original_lines, 0);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 618,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 619,
          "content": "        // Check prompt indices - later edits override, so \"original\" is from edit 1",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 620,
          "content": "        let first_ai = result.lines.iter().find(|l| l.content == \"first AI\").unwrap();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 621,
          "content": "        // first AI appears in edit 0's output and edit 1's output, later wins",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 622,
          "content": "        assert_eq!(first_ai.prompt_index, Some(1));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 623,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 624,
          "content": "        let second_ai = result.lines.iter().find(|l| l.content == \"second AI\").unwrap();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 625,
          "content": "        assert_eq!(second_ai.prompt_index, Some(1));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 626,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 627,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 628,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 629,
          "content": "    fn test_only_original_no_ai_edits() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 630,
          "content": "        // Test that without AI edits, original lines stay original",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 631,
          "content": "        let history = FileEditHistory::new(\"test.rs\", Some(\"line1\\nline2\\n\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 632,
          "content": "        // No AI edits added",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 633,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 634,
          "content": "        let result = ThreeWayAnalyzer::analyze(&history, \"line1\\nline2\\nline3\\n\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 635,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 636,
          "content": "        // line1, line2 are original (no AI touched them)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 637,
          "content": "        // line3 is human (added without AI)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 638,
          "content": "        assert_eq!(result.summary.original_lines, 2);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 639,
          "content": "        assert_eq!(result.summary.human_lines, 1);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 640,
          "content": "        assert_eq!(result.summary.ai_lines, 0);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 641,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 642,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 643,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 644,
          "content": "    fn test_whitespace_normalization() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 645,
          "content": "        // Test that trailing whitespace differences don't affect attribution",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 646,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(\"\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 647,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 648,
          "content": "        // AI generates lines with trailing spaces",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 649,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 650,
          "content": "            \"Generate code\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 651,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 652,
          "content": "            \"Write\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 653,
          "content": "            \"\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 654,
          "content": "            \"fn main() {  \\n    println!(\\\"hello\\\");  \\n}\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 655,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 656,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 657,
          "content": "        // Final commit has trailing spaces stripped (common git behavior)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 658,
          "content": "        let final_content = \"fn main() {\\n    println!(\\\"hello\\\");\\n}\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 659,
          "content": "        let result = ThreeWayAnalyzer::analyze(&history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 660,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 661,
          "content": "        // All lines should be AI despite whitespace differences",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 662,
          "content": "        assert_eq!(result.summary.ai_lines, 3, \"All lines should be AI\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 663,
          "content": "        assert_eq!(result.summary.human_lines, 0, \"No human lines expected\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 664,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 665,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 666,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 667,
          "content": "    fn test_empty_line_attribution() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 668,
          "content": "        // Test that empty lines in AI output are properly attributed",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 669,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(\"\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 670,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 671,
          "content": "        // AI generates code with empty lines",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 672,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 673,
          "content": "            \"Generate code with spacing\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 674,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 675,
          "content": "            \"Write\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 676,
          "content": "            \"\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 677,
          "content": "            \"fn main() {\\n\\n    println!(\\\"hello\\\");\\n\\n}\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 678,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 679,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 680,
          "content": "        let final_content = \"fn main() {\\n\\n    println!(\\\"hello\\\");\\n\\n}\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 681,
          "content": "        let result = ThreeWayAnalyzer::analyze(&history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 682,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 683,
          "content": "        // All lines including empty ones should be AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 684,
          "content": "        assert_eq!(result.summary.ai_lines, 5, \"All 5 lines should be AI\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 685,
          "content": "        assert_eq!(result.summary.human_lines, 0, \"No human lines expected\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 686,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 687,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 688,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 689,
          "content": "    fn test_tabs_vs_spaces() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 690,
          "content": "        // Test that different indentation styles still match",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 691,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(\"\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 692,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 693,
          "content": "        // AI generates with spaces",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 694,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 695,
          "content": "            \"Generate code\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 696,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 697,
          "content": "            \"Write\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 698,
          "content": "            \"\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 699,
          "content": "            \"fn main() {\\n    code();\\n}\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 700,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 701,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 702,
          "content": "        // Final uses same content (tabs would need different handling)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 703,
          "content": "        let final_content = \"fn main() {\\n    code();\\n}\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 704,
          "content": "        let result = ThreeWayAnalyzer::analyze(&history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 705,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 706,
          "content": "        assert_eq!(result.summary.ai_lines, 3);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 707,
          "content": "        assert_eq!(result.summary.human_lines, 0);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 708,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 709,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 710,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 711,
          "content": "    fn test_diff_unmapped_lines_still_attributed_to_ai() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 712,
          "content": "        // This test covers the critical bug fix:",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 713,
          "content": "        // When the diff algorithm sees structural changes, it may not map identical lines",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 714,
          "content": "        // (treating them as Delete+Insert instead of Equal). We need to still attribute",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 715,
          "content": "        // those lines to AI if they exist in the AI output.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 716,
          "content": "        let original = \"fn foo() {\\n    old_code();\\n}\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 717,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(original));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 718,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 719,
          "content": "        // AI rewrites the function with new content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 720,
          "content": "        // The closing brace \"}\" exists in both, but diff might not map it",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 721,
          "content": "        let ai_output = \"fn foo() {\\n    new_code();\\n    more_code();\\n}\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 722,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 723,
          "content": "            \"Rewrite function\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 724,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 725,
          "content": "            \"Edit\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 726,
          "content": "            original,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 727,
          "content": "            ai_output,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 728,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 729,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 730,
          "content": "        // Final content matches AI output exactly",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 731,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, ai_output);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 732,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 733,
          "content": "        // All lines should be AI - especially the closing brace",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 734,
          "content": "        assert_eq!(result.summary.ai_lines, 4, \"All lines should be AI\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 735,
          "content": "        assert_eq!(result.summary.human_lines, 0, \"No human lines expected\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 736,
          "content": "        assert_eq!(result.summary.original_lines, 0, \"No original lines (all in AI output)\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 737,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 738,
          "content": "        // Verify the closing brace specifically is AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 739,
          "content": "        let closing_brace = result.lines.iter().find(|l| l.content == \"}\").unwrap();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 740,
          "content": "        assert!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 741,
          "content": "            matches!(closing_brace.source, LineSource::AI { .. }),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 742,
          "content": "            \"Closing brace should be AI, got {:?}\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 743,
          "content": "            closing_brace.source",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 744,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 745,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 746,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 747,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 748,
          "content": "    fn test_debug_attribution_flow() {",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 749,
          "content": "        // Debug test to verify attribution logic",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 750,
          "content": "        let original = \"line1\\nline2\\nline3\\nline4\\nline5\\n\";",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 751,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(original));",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 752,
          "content": "",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 753,
          "content": "        // First AI edit: adds line6, line7",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 754,
          "content": "        let after1 = \"line1\\nline2\\nline3\\nline4\\nline5\\nline6\\nline7\\n\";",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 755,
          "content": "        history.add_edit(AIEdit::new(\"prompt1\", 0, \"Edit\", original, after1));",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 756,
          "content": "",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 757,
          "content": "        // Second AI edit: adds line8 and modifies line3",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 758,
          "content": "        let after2 = \"line1\\nline2\\nLINE3_MODIFIED\\nline4\\nline5\\nline6\\nline7\\nline8\\n\";",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 759,
          "content": "        history.add_edit(AIEdit::new(\"prompt2\", 1, \"Edit\", after1, after2));",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 760,
          "content": "",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 761,
          "content": "        // Final content matches AI edit exactly",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 762,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, after2);",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 763,
          "content": "",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 764,
          "content": "        println!(\"\\nAttribution results:\");",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 765,
          "content": "        println!(\"  AI lines: {}\", result.summary.ai_lines);",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 766,
          "content": "        println!(\"  AI modified lines: {}\", result.summary.ai_modified_lines);",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 767,
          "content": "        println!(\"  Original lines: {}\", result.summary.original_lines);",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 768,
          "content": "        println!(\"  Human lines: {}\", result.summary.human_lines);",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 769,
          "content": "",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 770,
          "content": "        for line in &result.lines {",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 771,
          "content": "            println!(\"  Line {}: {:?} - '{}'\", line.line_number, line.source, line.content);",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 772,
          "content": "        }",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 773,
          "content": "",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 774,
          "content": "        // All 8 lines should be AI (they're all in the AI edit output)",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 775,
          "content": "        assert_eq!(result.summary.ai_lines, 8, \"All lines should be AI\");",
          "source": {
            "type": "AI",
            "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3"
          },
          "edit_id": "f5586da8-ee78-4615-aadd-138176af9fe3",
          "prompt_index": 0,
          "confidence": 1.0
        },
        {
          "line_number": 776,
          "content": "        assert_eq!(result.summary.human_lines, 0, \"No human lines expected\");",
          "source": {
            "type": "AIModified",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
            "similarity": 0.7710843373493976
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 0.7710843373493976
        },
        {
          "line_number": 777,
          "content": "    }",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 778,
          "content": "",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 779,
          "content": "    #[test]",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 780,
          "content": "    fn test_duplicate_lines_in_ai_output() {",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 781,
          "content": "        // Test that duplicate lines (like closing braces) are properly attributed",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 782,
          "content": "        // This tests the real-world scenario where the same line content appears multiple times",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 783,
          "content": "        let original = r#\"fn foo() {",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 784,
          "content": "    code();",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 785,
          "content": "}",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 786,
          "content": "\"#;",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 787,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(original));",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 788,
          "content": "",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 789,
          "content": "        // AI adds a new function with similar structure (duplicate \"}\" and empty lines)",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 790,
          "content": "        let after1 = r#\"fn foo() {",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 791,
          "content": "    code();",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 792,
          "content": "}",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 793,
          "content": "",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 794,
          "content": "fn bar() {",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 795,
          "content": "    more_code();",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 796,
          "content": "}",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 797,
          "content": "\"#;",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 798,
          "content": "        history.add_edit(AIEdit::new(\"Add bar function\", 0, \"Edit\", original, after1));",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 799,
          "content": "",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 800,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, after1);",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 801,
          "content": "",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 802,
          "content": "        println!(\"\\nDuplicate lines test:\");",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 803,
          "content": "        for line in &result.lines {",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 804,
          "content": "            let source_str = match &line.source {",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 805,
          "content": "                LineSource::AI { .. } => \"AI\",",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 806,
          "content": "                LineSource::Original => \"Orig\",",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 807,
          "content": "                LineSource::Human => \"Human\",",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 808,
          "content": "                _ => \"Other\",",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 809,
          "content": "            };",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 810,
          "content": "            println!(\"  Line {}: {} - '{}'\", line.line_number, source_str, line.content);",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 811,
          "content": "        }",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 812,
          "content": "",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 813,
          "content": "        // All lines should be AI (including the duplicate \"}\")",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 814,
          "content": "        assert_eq!(result.summary.human_lines, 0, \"No human lines - all are in AI output\");",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 815,
          "content": "        // The closing brace \"}\" appears twice but both should be AI",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 816,
          "content": "        let closing_braces: Vec<_> = result.lines.iter().filter(|l| l.content == \"}\").collect();",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 817,
          "content": "        assert_eq!(closing_braces.len(), 2, \"Should have 2 closing braces\");",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 818,
          "content": "        for brace in closing_braces {",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 819,
          "content": "            assert!(matches!(brace.source, LineSource::AI { .. }),",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 820,
          "content": "                \"Closing brace at line {} should be AI, got {:?}\", brace.line_number, brace.source);",
          "source": {
            "type": "AI",
            "edit_id": "d506489f-e494-42e6-9305-943cb921db56"
          },
          "edit_id": "d506489f-e494-42e6-9305-943cb921db56",
          "prompt_index": 1,
          "confidence": 1.0
        },
        {
          "line_number": 821,
          "content": "        }",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 822,
          "content": "    }",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 823,
          "content": "",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 824,
          "content": "    #[test]",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        },
        {
          "line_number": 825,
          "content": "    fn test_common_patterns_attributed_to_ai() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 826,
          "content": "        // Test that common patterns like empty lines, closing braces, and doc comments",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 827,
          "content": "        // are properly attributed to AI when they appear in AI output",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 828,
          "content": "        let original = \"\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 829,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(original));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 830,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 831,
          "content": "        // AI generates code with common patterns",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 832,
          "content": "        let ai_output = r#\"/// A test function",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 833,
          "content": "#[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 834,
          "content": "fn test() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 835,
          "content": "    assert!(true);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 836,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 837,
          "content": "\"#;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 838,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 839,
          "content": "            \"Generate test\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 840,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 841,
          "content": "            \"Write\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 842,
          "content": "            original,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 843,
          "content": "            ai_output,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 844,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 845,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 846,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, ai_output);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 847,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 848,
          "content": "        // All lines should be AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 849,
          "content": "        assert_eq!(result.summary.ai_lines, 5, \"All 5 lines should be AI\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 850,
          "content": "        assert_eq!(result.summary.human_lines, 0, \"No human lines\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 851,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 852,
          "content": "        // Check each line individually",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 853,
          "content": "        for line in &result.lines {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 854,
          "content": "            assert!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 855,
          "content": "                matches!(line.source, LineSource::AI { .. }),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 856,
          "content": "                \"Line '{}' should be AI, got {:?}\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 857,
          "content": "                line.content,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 858,
          "content": "                line.source",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 859,
          "content": "            );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 860,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 861,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 862,
          "content": "}",
          "source": {
            "type": "Human"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 0.9
        }
      ],
      "summary": {
        "total_lines": 862,
        "ai_lines": 46,
        "ai_modified_lines": 1,
        "human_lines": 31,
        "original_lines": 784,
        "unknown_lines": 0
      }
    }
  ]
}