{
  "version": 2,
  "session": {
    "session_id": "a60ff7c3-a36f-468e-b6ec-89c77b0eaa1a",
    "model": {
      "id": "claude-opus-4-5-20251101",
      "provider": "anthropic"
    },
    "started_at": "2026-02-01T01:49:48.137289+00:00",
    "prompt_count": 4
  },
  "prompts": [
    {
      "index": 0,
      "text": "\"Two things on this PR: I noticed that there are still some reported \\\"human\\\" modified lines of code throughout the files in this PR, despite all lines of code being written by claude code. Analyze this commit and what was reported as human modified and see if you can determine root causes for this mis-attributions and sensible fixes that we can add in this PR to address them.\"",
      "timestamp": "2026-02-01T01:49:48.137523+00:00",
      "affected_files": [
        "src/capture/threeway.rs"
      ]
    },
    {
      "index": 1,
      "text": "\"Two things on this PR: I noticed that there are still some reported \\\"human\\\" modified lines of code throughout the files in this PR, despite all lines of code being written by claude code. Analyze this commit and what was reported as human modified and see if you can determine root causes for this mis-attributions and sensible fixes that we can add in this PR to address them.\"",
      "timestamp": "2026-02-01T01:49:55.492532+00:00",
      "affected_files": [
        "src/capture/threeway.rs"
      ]
    },
    {
      "index": 2,
      "text": "\"Two things on this PR: I noticed that there are still some reported \\\"human\\\" modified lines of code throughout the files in this PR, despite all lines of code being written by claude code. Analyze this commit and what was reported as human modified and see if you can determine root causes for this mis-attributions and sensible fixes that we can add in this PR to address them.\"",
      "timestamp": "2026-02-01T01:50:17.005625+00:00",
      "affected_files": [
        "src/capture/threeway.rs"
      ]
    },
    {
      "index": 3,
      "text": "\"Two things on this PR: I noticed that there are still some reported \\\"human\\\" modified lines of code throughout the files in this PR, despite all lines of code being written by claude code. Analyze this commit and what was reported as human modified and see if you can determine root causes for this mis-attributions and sensible fixes that we can add in this PR to address them.\"",
      "timestamp": "2026-02-01T01:50:55.793591+00:00",
      "affected_files": [
        "src/capture/threeway.rs"
      ]
    }
  ],
  "files": [
    {
      "path": "src/capture/threeway.rs",
      "lines": [
        {
          "line_number": 1,
          "content": "use std::collections::{HashMap, HashSet};",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 2,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 3,
          "content": "use similar::{ChangeTag, TextDiff};",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 4,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 5,
          "content": "use crate::capture::snapshot::{",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 6,
          "content": "    FileAttributionResult, FileEditHistory, LineAttribution, LineSource,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 7,
          "content": "};",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 8,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 9,
          "content": "/// Default similarity threshold for AIModified detection",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 10,
          "content": "/// This can be overridden via config (analysis.similarity_threshold)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 11,
          "content": "pub const DEFAULT_SIMILARITY_THRESHOLD: f64 = 0.6;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 12,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 13,
          "content": "/// Normalize a line for comparison purposes.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 14,
          "content": "/// - Trims trailing whitespace (but preserves leading indentation)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 15,
          "content": "/// - Normalizes line endings",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 16,
          "content": "/// - Handles cross-platform line ending differences",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 17,
          "content": "fn normalize_line(line: &str) -> String {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 18,
          "content": "    line.trim_end().to_string()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 19,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 20,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 21,
          "content": "/// Normalize a line for use as a hash key.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 22,
          "content": "/// Uses the same normalization as normalize_line.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 23,
          "content": "fn normalize_for_key(line: &str) -> String {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 24,
          "content": "    normalize_line(line)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 25,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 26,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 27,
          "content": "/// Performs three-way attribution analysis",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 28,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 29,
          "content": "/// Given:",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 30,
          "content": "/// - Original content (before any AI edits)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 31,
          "content": "/// - AI edit history (sequence of AI changes)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 32,
          "content": "/// - Final content (what's being committed)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 33,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 34,
          "content": "/// Determines for each line in final content:",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 35,
          "content": "/// - Was it from the original file?",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 36,
          "content": "/// - Was it added by AI (and which edit/prompt)?",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 37,
          "content": "/// - Was it added by AI but modified by human?",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 38,
          "content": "/// - Was it added by human after AI edits?",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 39,
          "content": "pub struct ThreeWayAnalyzer;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 40,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 41,
          "content": "impl ThreeWayAnalyzer {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 42,
          "content": "    /// Analyze a file's final content against its edit history",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 43,
          "content": "    pub fn analyze(history: &FileEditHistory, final_content: &str) -> FileAttributionResult {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 44,
          "content": "        let final_lines: Vec<&str> = final_content.lines().collect();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 45,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 46,
          "content": "        // Build lookup tables for efficient matching",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 47,
          "content": "        let original_lines = build_line_set(&history.original.content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 48,
          "content": "        let ai_line_sources = build_ai_line_map(history);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 49,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 50,
          "content": "        // Analyze each line in the final content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 51,
          "content": "        let mut attributions = Vec::with_capacity(final_lines.len());",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 52,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 53,
          "content": "        for (idx, line) in final_lines.iter().enumerate() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 54,
          "content": "            let line_number = (idx + 1) as u32;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 55,
          "content": "            let attribution = attribute_line(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 56,
          "content": "                line,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 57,
          "content": "                line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 58,
          "content": "                &original_lines,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 59,
          "content": "                &ai_line_sources,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 60,
          "content": "                history,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 61,
          "content": "            );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 62,
          "content": "            attributions.push(attribution);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 63,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 64,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 65,
          "content": "        // Post-process: improve attribution using context",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 66,
          "content": "        improve_attributions_with_context(&mut attributions, history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 67,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 68,
          "content": "        let summary = FileAttributionResult::compute_summary(&attributions);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 69,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 70,
          "content": "        FileAttributionResult {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 71,
          "content": "            path: history.path.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 72,
          "content": "            lines: attributions,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 73,
          "content": "            summary,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 74,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 75,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 76,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 77,
          "content": "    /// Analyze with position-aware diff for better accuracy",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 78,
          "content": "    pub fn analyze_with_diff(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 79,
          "content": "        history: &FileEditHistory,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 80,
          "content": "        final_content: &str,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 81,
          "content": "    ) -> FileAttributionResult {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 82,
          "content": "        let final_lines: Vec<&str> = final_content.lines().collect();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 83,
          "content": "        let mut attributions = Vec::with_capacity(final_lines.len());",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 84,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 85,
          "content": "        // If no AI edits, everything is original or human",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 86,
          "content": "        if history.edits.is_empty() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 87,
          "content": "            for (idx, line) in final_lines.iter().enumerate() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 88,
          "content": "                let line_number = (idx + 1) as u32;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 89,
          "content": "                let source = if line_in_content(line, &history.original.content) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 90,
          "content": "                    LineSource::Original",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 91,
          "content": "                } else {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 92,
          "content": "                    LineSource::Human",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 93,
          "content": "                };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 94,
          "content": "                attributions.push(LineAttribution {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 95,
          "content": "                    line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 96,
          "content": "                    content: line.to_string(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 97,
          "content": "                    source,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 98,
          "content": "                    edit_id: None,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 99,
          "content": "                    prompt_index: None,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 100,
          "content": "                    confidence: 1.0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 101,
          "content": "                });",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 102,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 103,
          "content": "            let summary = FileAttributionResult::compute_summary(&attributions);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 104,
          "content": "            return FileAttributionResult {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 105,
          "content": "                path: history.path.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 106,
          "content": "                lines: attributions,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 107,
          "content": "                summary,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 108,
          "content": "            };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 109,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 110,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 111,
          "content": "        // Perform diff-based analysis",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 112,
          "content": "        // Compare: original -> final, and latest_ai -> final",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 113,
          "content": "        let latest_ai = history.latest_ai_content();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 114,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 115,
          "content": "        // Build lookup sets",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 116,
          "content": "        let original_lines = build_line_set(&history.original.content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 117,
          "content": "        let ai_line_map = build_ai_line_map(history);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 118,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 119,
          "content": "        // Track which final lines match AI content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 120,
          "content": "        let ai_to_final_mapping = diff_map_lines(&latest_ai.content, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 121,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 122,
          "content": "        // Track which final lines match original content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 123,
          "content": "        let original_to_final_mapping = diff_map_lines(&history.original.content, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 124,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 125,
          "content": "        // Build reverse map: final line index -> source",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 126,
          "content": "        let mut final_line_sources: HashMap<usize, (LineSource, Option<String>, Option<u32>)> =",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 127,
          "content": "            HashMap::new();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 128,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 129,
          "content": "        // First pass: mark lines that exist in original as Original",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 130,
          "content": "        // (Lines in both original and AI should be Original - they weren't changed)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 131,
          "content": "        for (_, final_idx) in &original_to_final_mapping {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 132,
          "content": "            final_line_sources.insert(*final_idx, (LineSource::Original, None, None));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 133,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 134,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 135,
          "content": "        // Second pass: mark lines from AI edits that weren't mapped from original",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 136,
          "content": "        // Key insight: if a final line has position mapping from AI but NOT from original,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 137,
          "content": "        // it's AI-generated - even if the content happens to match something in original",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 138,
          "content": "        // (e.g., a `}` added by AI shouldn't be marked as Original just because",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 139,
          "content": "        // the original file also had a `}` at a different position)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 140,
          "content": "        for (ai_idx, final_idx) in &ai_to_final_mapping {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 141,
          "content": "            // Skip if already marked (came from original position mapping)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 142,
          "content": "            if final_line_sources.contains_key(final_idx) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 143,
          "content": "                continue;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 144,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 145,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 146,
          "content": "            let ai_line = latest_ai.lines().get(*ai_idx).copied().unwrap_or(\"\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 147,
          "content": "            let normalized = normalize_for_key(ai_line);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 148,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 149,
          "content": "            // This line was mapped from AI output and NOT from original position",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 150,
          "content": "            // So it's AI-generated (regardless of whether similar content exists in original)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 151,
          "content": "            if let Some((edit_id, prompt_idx)) = ai_line_map.get(&normalized) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 152,
          "content": "                final_line_sources.insert(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 153,
          "content": "                    *final_idx,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 154,
          "content": "                    (",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 155,
          "content": "                        LineSource::AI {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 156,
          "content": "                            edit_id: edit_id.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 157,
          "content": "                        },",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 158,
          "content": "                        Some(edit_id.clone()),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 159,
          "content": "                        Some(*prompt_idx),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 160,
          "content": "                    ),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 161,
          "content": "                );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 162,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 163,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 164,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 165,
          "content": "        // Third pass: check unmapped lines",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 166,
          "content": "        for (idx, line) in final_lines.iter().enumerate() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 167,
          "content": "            if final_line_sources.contains_key(&idx) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 168,
          "content": "                continue;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 169,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 170,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 171,
          "content": "            let normalized = normalize_for_key(line);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 172,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 173,
          "content": "            // Check if line exists in original first",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 174,
          "content": "            if original_lines.contains(&normalized) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 175,
          "content": "                final_line_sources.insert(idx, (LineSource::Original, None, None));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 176,
          "content": "                continue;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 177,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 178,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 179,
          "content": "            // Check if line is in AI output (but not original)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 180,
          "content": "            if let Some((edit_id, prompt_idx)) = ai_line_map.get(&normalized) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 181,
          "content": "                final_line_sources.insert(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 182,
          "content": "                    idx,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 183,
          "content": "                    (",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 184,
          "content": "                        LineSource::AI {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 185,
          "content": "                            edit_id: edit_id.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 186,
          "content": "                        },",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 187,
          "content": "                        Some(edit_id.clone()),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 188,
          "content": "                        Some(*prompt_idx),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 189,
          "content": "                    ),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 190,
          "content": "                );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 191,
          "content": "                continue;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 192,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 193,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 194,
          "content": "            // Check if this is similar to an AI line (modified)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 195,
          "content": "            if let Some((edit_id, prompt_idx, similarity)) =",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 196,
          "content": "                find_similar_ai_line(line, &ai_line_map, DEFAULT_SIMILARITY_THRESHOLD)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 197,
          "content": "            {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 198,
          "content": "                final_line_sources.insert(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 199,
          "content": "                    idx,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 200,
          "content": "                    (",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 201,
          "content": "                        LineSource::AIModified {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 202,
          "content": "                            edit_id: edit_id.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 203,
          "content": "                            similarity,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 204,
          "content": "                        },",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 205,
          "content": "                        Some(edit_id),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 206,
          "content": "                        Some(prompt_idx),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 207,
          "content": "                    ),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 208,
          "content": "                );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 209,
          "content": "                continue;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 210,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 211,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 212,
          "content": "            // New line added by human",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 213,
          "content": "            final_line_sources.insert(idx, (LineSource::Human, None, None));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 214,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 215,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 216,
          "content": "        // Build final attributions",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 217,
          "content": "        for (idx, line) in final_lines.iter().enumerate() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 218,
          "content": "            let line_number = (idx + 1) as u32;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 219,
          "content": "            let (source, edit_id, prompt_index) = final_line_sources",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 220,
          "content": "                .get(&idx)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 221,
          "content": "                .cloned()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 222,
          "content": "                .unwrap_or((LineSource::Unknown, None, None));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 223,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 224,
          "content": "            let confidence = match &source {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 225,
          "content": "                LineSource::Original => 1.0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 226,
          "content": "                LineSource::AI { .. } => 1.0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 227,
          "content": "                LineSource::AIModified { similarity, .. } => *similarity,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 228,
          "content": "                LineSource::Human => 0.9,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 229,
          "content": "                LineSource::Unknown => 0.5,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 230,
          "content": "            };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 231,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 232,
          "content": "            attributions.push(LineAttribution {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 233,
          "content": "                line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 234,
          "content": "                content: line.to_string(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 235,
          "content": "                source,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 236,
          "content": "                edit_id,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 237,
          "content": "                prompt_index,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 238,
          "content": "                confidence,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 239,
          "content": "            });",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 240,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 241,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 242,
          "content": "        // Post-process: improve attribution using context and block matching",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 243,
          "content": "        improve_attributions_with_context(&mut attributions, history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 244,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 245,
          "content": "        let summary = FileAttributionResult::compute_summary(&attributions);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 246,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 247,
          "content": "        FileAttributionResult {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 248,
          "content": "            path: history.path.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 249,
          "content": "            lines: attributions,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 250,
          "content": "            summary,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 251,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 252,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 253,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 254,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 255,
          "content": "/// Build a set of normalized lines from content for fast lookup",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 256,
          "content": "fn build_line_set(content: &str) -> HashSet<String> {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 257,
          "content": "    content.lines().map(normalize_for_key).collect()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 258,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 259,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 260,
          "content": "/// Build a map from normalized line content -> (edit_id, prompt_index) for all AI edits",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 261,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 262,
          "content": "/// IMPORTANT: All lines in an AI edit's `after` content are considered AI-generated,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 263,
          "content": "/// not just lines that differ from `before`. This is because when AI writes/edits a file,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 264,
          "content": "/// it produces the entire output - even if some lines coincidentally match the original,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 265,
          "content": "/// the AI chose to include them.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 266,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 267,
          "content": "/// Lines are normalized (trailing whitespace trimmed) to handle git/editor differences.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 268,
          "content": "fn build_ai_line_map(history: &FileEditHistory) -> HashMap<String, (String, u32)> {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 269,
          "content": "    let mut map = HashMap::new();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 270,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 271,
          "content": "    // Process edits in order - later edits override earlier ones",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 272,
          "content": "    for edit in &history.edits {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 273,
          "content": "        // ALL lines in the AI's output are AI-generated",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 274,
          "content": "        // This ensures complete file rewrites are properly attributed",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 275,
          "content": "        for line in edit.after.content.lines() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 276,
          "content": "            map.insert(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 277,
          "content": "                normalize_for_key(line),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 278,
          "content": "                (edit.edit_id.clone(), edit.prompt_index),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 279,
          "content": "            );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 280,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 281,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 282,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 283,
          "content": "    map",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 284,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 285,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 286,
          "content": "/// Check if a normalized line exists in content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 287,
          "content": "fn line_in_content(line: &str, content: &str) -> bool {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 288,
          "content": "    let normalized = normalize_for_key(line);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 289,
          "content": "    content.lines().any(|l| normalize_for_key(l) == normalized)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 290,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 291,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 292,
          "content": "/// Map line indices from source to target using diff",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 293,
          "content": "fn diff_map_lines(source: &str, target: &str) -> Vec<(usize, usize)> {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 294,
          "content": "    let diff = TextDiff::from_lines(source, target);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 295,
          "content": "    let mut mappings = Vec::new();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 296,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 297,
          "content": "    let mut source_idx = 0usize;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 298,
          "content": "    let mut target_idx = 0usize;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 299,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 300,
          "content": "    for change in diff.iter_all_changes() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 301,
          "content": "        match change.tag() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 302,
          "content": "            ChangeTag::Equal => {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 303,
          "content": "                mappings.push((source_idx, target_idx));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 304,
          "content": "                source_idx += 1;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 305,
          "content": "                target_idx += 1;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 306,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 307,
          "content": "            ChangeTag::Delete => {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 308,
          "content": "                source_idx += 1;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 309,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 310,
          "content": "            ChangeTag::Insert => {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 311,
          "content": "                target_idx += 1;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 312,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 313,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 314,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 315,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 316,
          "content": "    mappings",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 317,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 318,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 319,
          "content": "/// Attribute a single line",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 320,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 321,
          "content": "/// Priority order:",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 322,
          "content": "/// 1. Original - if line existed before AI edits and is unchanged",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 323,
          "content": "/// 2. AI - if line is in the AI edit output but NOT in original (actually changed)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 324,
          "content": "/// 3. AIModified - if line is similar to an AI line",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 325,
          "content": "/// 4. Human - line was added after AI edits",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 326,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 327,
          "content": "/// All lookups use normalized line content to handle whitespace differences.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 328,
          "content": "fn attribute_line(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 329,
          "content": "    line: &str,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 330,
          "content": "    line_number: u32,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 331,
          "content": "    original_lines: &HashSet<String>,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 332,
          "content": "    ai_line_sources: &HashMap<String, (String, u32)>,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 333,
          "content": "    _history: &FileEditHistory,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 334,
          "content": ") -> LineAttribution {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 335,
          "content": "    let normalized = normalize_for_key(line);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 336,
          "content": "    let in_original = original_lines.contains(&normalized);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 337,
          "content": "    let in_ai = ai_line_sources.get(&normalized);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 338,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 339,
          "content": "    // If line exists in original AND in AI output, it's unchanged - mark as Original",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 340,
          "content": "    // This prevents counting context lines that AI included but didn't change",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 341,
          "content": "    if in_original && in_ai.is_some() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 342,
          "content": "        return LineAttribution {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 343,
          "content": "            line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 344,
          "content": "            content: line.to_string(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 345,
          "content": "            source: LineSource::Original,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 346,
          "content": "            edit_id: None,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 347,
          "content": "            prompt_index: None,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 348,
          "content": "            confidence: 1.0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 349,
          "content": "        };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 350,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 351,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 352,
          "content": "    // If line is in original but NOT in AI output, it's still Original",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 353,
          "content": "    // (The AI didn't touch this line at all)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 354,
          "content": "    if in_original {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 355,
          "content": "        return LineAttribution {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 356,
          "content": "            line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 357,
          "content": "            content: line.to_string(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 358,
          "content": "            source: LineSource::Original,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 359,
          "content": "            edit_id: None,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 360,
          "content": "            prompt_index: None,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 361,
          "content": "            confidence: 1.0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 362,
          "content": "        };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 363,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 364,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 365,
          "content": "    // If line is in AI output but NOT in original, it's AI-generated",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 366,
          "content": "    if let Some((edit_id, prompt_idx)) = in_ai {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 367,
          "content": "        return LineAttribution {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 368,
          "content": "            line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 369,
          "content": "            content: line.to_string(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 370,
          "content": "            source: LineSource::AI {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 371,
          "content": "                edit_id: edit_id.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 372,
          "content": "            },",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 373,
          "content": "            edit_id: Some(edit_id.clone()),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 374,
          "content": "            prompt_index: Some(*prompt_idx),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 375,
          "content": "            confidence: 1.0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 376,
          "content": "        };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 377,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 378,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 379,
          "content": "    // Check if line is similar to an AI line (human modified AI output)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 380,
          "content": "    if let Some((edit_id, prompt_idx, similarity)) =",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 381,
          "content": "        find_similar_ai_line(line, ai_line_sources, 0.6)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 382,
          "content": "    {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 383,
          "content": "        return LineAttribution {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 384,
          "content": "            line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 385,
          "content": "            content: line.to_string(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 386,
          "content": "            source: LineSource::AIModified {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 387,
          "content": "                edit_id: edit_id.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 388,
          "content": "                similarity,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 389,
          "content": "            },",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 390,
          "content": "            edit_id: Some(edit_id),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 391,
          "content": "            prompt_index: Some(prompt_idx),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 392,
          "content": "            confidence: similarity,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 393,
          "content": "        };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 394,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 395,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 396,
          "content": "    // Line doesn't exist in original or AI output - must be human-added",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 397,
          "content": "    LineAttribution {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 398,
          "content": "        line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 399,
          "content": "        content: line.to_string(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 400,
          "content": "        source: LineSource::Human,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 401,
          "content": "        edit_id: None,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 402,
          "content": "        prompt_index: None,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 403,
          "content": "        confidence: 0.9,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 404,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 405,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 406,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 407,
          "content": "/// Find a similar AI line using edit distance",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 408,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 409,
          "content": "/// Note: Empty/whitespace-only lines are handled by exact matching in attribute_line,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 410,
          "content": "/// so this function focuses on non-trivial content similarity.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 411,
          "content": "fn find_similar_ai_line(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 412,
          "content": "    line: &str,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 413,
          "content": "    ai_lines: &HashMap<String, (String, u32)>,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 414,
          "content": "    threshold: f64,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 415,
          "content": ") -> Option<(String, u32, f64)> {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 416,
          "content": "    let line_trimmed = line.trim();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 417,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 418,
          "content": "    // Empty lines should be handled by exact matching, not similarity",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 419,
          "content": "    // (empty lines match other empty lines with 100% similarity via normalize_for_key)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 420,
          "content": "    if line_trimmed.is_empty() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 421,
          "content": "        return None;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 422,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 423,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 424,
          "content": "    let mut best_match: Option<(String, u32, f64)> = None;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 425,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 426,
          "content": "    for (ai_line, (edit_id, prompt_idx)) in ai_lines {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 427,
          "content": "        let ai_trimmed = ai_line.trim();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 428,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 429,
          "content": "        // Skip empty AI lines in similarity comparison",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 430,
          "content": "        if ai_trimmed.is_empty() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 431,
          "content": "            continue;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 432,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 433,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 434,
          "content": "        let similarity = compute_similarity(line_trimmed, ai_trimmed);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 435,
          "content": "        if similarity >= threshold",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 436,
          "content": "            && (best_match.is_none() || similarity > best_match.as_ref().unwrap().2)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 437,
          "content": "        {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 438,
          "content": "            best_match = Some((edit_id.clone(), *prompt_idx, similarity));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 439,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 440,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 441,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 442,
          "content": "    best_match",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 443,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 444,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 445,
          "content": "/// Compute similarity between two strings (0.0 - 1.0)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 446,
          "content": "fn compute_similarity(a: &str, b: &str) -> f64 {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 447,
          "content": "    if a == b {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 448,
          "content": "        return 1.0;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 449,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 450,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 451,
          "content": "    if a.is_empty() || b.is_empty() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 452,
          "content": "        return 0.0;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 453,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 454,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 455,
          "content": "    // Use longest common subsequence ratio",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 456,
          "content": "    let lcs_len = longest_common_subsequence(a, b);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 457,
          "content": "    let max_len = a.len().max(b.len()) as f64;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 458,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 459,
          "content": "    lcs_len as f64 / max_len",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 460,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 461,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 462,
          "content": "/// Compute length of longest common subsequence",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 463,
          "content": "fn longest_common_subsequence(a: &str, b: &str) -> usize {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 464,
          "content": "    let a_chars: Vec<char> = a.chars().collect();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 465,
          "content": "    let b_chars: Vec<char> = b.chars().collect();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 466,
          "content": "    let m = a_chars.len();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 467,
          "content": "    let n = b_chars.len();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 468,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 469,
          "content": "    // Optimization: if strings are very different in length, quick exit",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 470,
          "content": "    if (m as f64 / n as f64) < 0.5 || (n as f64 / m as f64) < 0.5 {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 471,
          "content": "        return 0;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 472,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 473,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 474,
          "content": "    let mut dp = vec![vec![0usize; n + 1]; m + 1];",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 475,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 476,
          "content": "    for i in 1..=m {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 477,
          "content": "        for j in 1..=n {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 478,
          "content": "            if a_chars[i - 1] == b_chars[j - 1] {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 479,
          "content": "                dp[i][j] = dp[i - 1][j - 1] + 1;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 480,
          "content": "            } else {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 481,
          "content": "                dp[i][j] = dp[i - 1][j].max(dp[i][j - 1]);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 482,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 483,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 484,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 485,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 486,
          "content": "    dp[m][n]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 487,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 488,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 489,
          "content": "/// Improve attributions using contextual information",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 490,
          "content": "fn improve_attributions_with_context(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 491,
          "content": "    attributions: &mut [LineAttribution],",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 492,
          "content": "    history: &FileEditHistory,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 493,
          "content": "    _final_content: &str,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 494,
          "content": ") {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 495,
          "content": "    let len = attributions.len();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 496,
          "content": "    if len < 2 {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 497,
          "content": "        return;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 498,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 499,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 500,
          "content": "    // First pass: handle unknown lines surrounded by AI lines",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 501,
          "content": "    for i in 1..len - 1 {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 502,
          "content": "        if attributions[i].source == LineSource::Unknown {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 503,
          "content": "            let prev_edit = attributions[i - 1].edit_id.clone();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 504,
          "content": "            let next_edit = attributions[i + 1].edit_id.clone();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 505,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 506,
          "content": "            if prev_edit.is_some() && prev_edit == next_edit {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 507,
          "content": "                attributions[i].source = LineSource::AIModified {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 508,
          "content": "                    edit_id: prev_edit.clone().unwrap(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 509,
          "content": "                    similarity: 0.5,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 510,
          "content": "                };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 511,
          "content": "                attributions[i].edit_id = prev_edit;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 512,
          "content": "                attributions[i].prompt_index = attributions[i - 1].prompt_index;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 513,
          "content": "                attributions[i].confidence = 0.5;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 514,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 515,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 516,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 517,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 518,
          "content": "    // Second pass: block-level matching for reformatted code",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 519,
          "content": "    // This handles cases where formatters (rustfmt, prettier, etc.) split",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 520,
          "content": "    // a single AI-generated line into multiple lines",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 521,
          "content": "    improve_attributions_with_block_matching(attributions, history);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 522,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 523,
          "content": "    // Third pass: context-based attribution for remaining unmatched lines",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 524,
          "content": "    // If a Human/AIModified line is surrounded by AI lines from the same edit,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 525,
          "content": "    // and it looks like a fragment (continuation of a split statement), attribute it to AI",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 526,
          "content": "    improve_attributions_with_surrounding_context(attributions);",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 527,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 528,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 529,
          "content": "/// Check if a line looks like a fragment of a split statement",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 530,
          "content": "fn looks_like_fragment(line: &str) -> bool {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 531,
          "content": "    let trimmed = line.trim();",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 532,
          "content": "    if trimmed.is_empty() {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 533,
          "content": "        return false;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 534,
          "content": "    }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 535,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 536,
          "content": "    // Starts with continuation characters (method chains, operators, closing parens)",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 537,
          "content": "    let starts_continuation = trimmed.starts_with('.')",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 538,
          "content": "        || trimmed.starts_with(',')",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 539,
          "content": "        || trimmed.starts_with(')')",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 540,
          "content": "        || trimmed.starts_with(']')",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 541,
          "content": "        || trimmed.starts_with('}')",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 542,
          "content": "        || trimmed.starts_with(\"&&\")",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 543,
          "content": "        || trimmed.starts_with(\"||\");",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 544,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 545,
          "content": "    // Ends with opening/continuation characters",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 546,
          "content": "    let ends_continuation = trimmed.ends_with('(')",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 547,
          "content": "        || trimmed.ends_with('[')",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 548,
          "content": "        || trimmed.ends_with('{')",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 549,
          "content": "        || trimmed.ends_with(',')",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 550,
          "content": "        || trimmed.ends_with('=')",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 551,
          "content": "        || trimmed.ends_with(\"&&\")",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 552,
          "content": "        || trimmed.ends_with(\"||\");",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 553,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 554,
          "content": "    // Common fragment patterns",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 555,
          "content": "    let is_common_fragment = trimmed == \");\"",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 556,
          "content": "        || trimmed == \")\"",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 557,
          "content": "        || trimmed == \"};\"",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 558,
          "content": "        || trimmed == \"}\"",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 559,
          "content": "        || trimmed == \"];\"",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 560,
          "content": "        || trimmed == \"]\"",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 561,
          "content": "        || trimmed.starts_with(\".unwrap(\")",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 562,
          "content": "        || trimmed.starts_with(\".context(\")",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 563,
          "content": "        || trimmed.starts_with(\".ok_or\")",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 564,
          "content": "        || trimmed.starts_with(\".expect(\")",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 565,
          "content": "        || trimmed.starts_with(\".map(\")",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 566,
          "content": "        || trimmed.starts_with(\".and_then(\")",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 567,
          "content": "        || trimmed.starts_with(\".or_else(\");",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 568,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 569,
          "content": "    starts_continuation || ends_continuation || is_common_fragment",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 570,
          "content": "}",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 571,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 572,
          "content": "/// Improve attributions using surrounding context",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 573,
          "content": "/// If Human/AIModified lines are surrounded by AI lines from the same edit,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 574,
          "content": "/// and the lines look like fragments, attribute them to AI",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 575,
          "content": "fn improve_attributions_with_surrounding_context(attributions: &mut [LineAttribution]) {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 576,
          "content": "    let len = attributions.len();",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 577,
          "content": "    if len < 3 {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 578,
          "content": "        return;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 579,
          "content": "    }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 580,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 581,
          "content": "    // Make multiple passes since fixing one line might enable fixing adjacent lines",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 582,
          "content": "    let mut changed = true;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 583,
          "content": "    let mut iterations = 0;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 584,
          "content": "    const MAX_ITERATIONS: usize = 5;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 585,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 586,
          "content": "    while changed && iterations < MAX_ITERATIONS {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 587,
          "content": "        changed = false;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 588,
          "content": "        iterations += 1;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 589,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 590,
          "content": "        for i in 1..len - 1 {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 591,
          "content": "            let is_unattributed = matches!(",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 592,
          "content": "                &attributions[i].source,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 593,
          "content": "                LineSource::Human | LineSource::AIModified { .. }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 594,
          "content": "            );",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 595,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 596,
          "content": "            if !is_unattributed {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 597,
          "content": "                continue;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 598,
          "content": "            }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 599,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 600,
          "content": "            // Check if surrounded by AI lines from the same edit",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 601,
          "content": "            let prev_edit = &attributions[i - 1].edit_id;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 602,
          "content": "            let next_edit = &attributions[i + 1].edit_id;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 603,
          "content": "            let prev_is_ai = matches!(",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 604,
          "content": "                &attributions[i - 1].source,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 605,
          "content": "                LineSource::AI { .. } | LineSource::AIModified { .. }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 606,
          "content": "            );",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 607,
          "content": "            let next_is_ai = matches!(",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 608,
          "content": "                &attributions[i + 1].source,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 609,
          "content": "                LineSource::AI { .. } | LineSource::AIModified { .. }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 610,
          "content": "            );",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 611,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 612,
          "content": "            if prev_is_ai",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 613,
          "content": "                && next_is_ai",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 614,
          "content": "                && prev_edit.is_some()",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 615,
          "content": "                && prev_edit == next_edit",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 616,
          "content": "                && looks_like_fragment(&attributions[i].content)",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 617,
          "content": "            {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 618,
          "content": "                let edit_id = prev_edit.clone().unwrap();",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 619,
          "content": "                let prompt_index = attributions[i - 1].prompt_index;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 620,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 621,
          "content": "                attributions[i].source = LineSource::AI {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 622,
          "content": "                    edit_id: edit_id.clone(),",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 623,
          "content": "                };",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 624,
          "content": "                attributions[i].edit_id = Some(edit_id);",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 625,
          "content": "                attributions[i].prompt_index = prompt_index;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 626,
          "content": "                attributions[i].confidence = 0.85; // High confidence from context",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 627,
          "content": "                changed = true;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 628,
          "content": "            }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 629,
          "content": "        }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 630,
          "content": "    }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 631,
          "content": "}",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 632,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 633,
          "content": "/// Normalize a string for block comparison by collapsing whitespace",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 634,
          "content": "/// and removing spaces that formatters add when splitting lines",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 635,
          "content": "fn normalize_for_block_comparison(s: &str) -> String {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 636,
          "content": "    let collapsed = s.split_whitespace().collect::<Vec<_>>().join(\" \");",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 637,
          "content": "    // Remove spaces before common continuation characters that rustfmt adds",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 638,
          "content": "    // when splitting lines (e.g., \"foo .bar()\" -> \"foo.bar()\")",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 639,
          "content": "    collapsed",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 640,
          "content": "        .replace(\" .\", \".\")",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 641,
          "content": "        .replace(\" ,\", \",\")",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 642,
          "content": "        .replace(\" ;\", \";\")",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 643,
          "content": "        .replace(\" )\", \")\")",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 644,
          "content": "        .replace(\"( \", \"(\")",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 645,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 646,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 647,
          "content": "/// Improve attributions by matching blocks of consecutive Human lines",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 648,
          "content": "/// against AI-generated content.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 649,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 650,
          "content": "/// This handles the case where code formatters split a single line into multiple lines.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 651,
          "content": "/// For example, rustfmt might split:",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 652,
          "content": "///   `let x = foo.bar().baz().qux();`",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 653,
          "content": "/// into:",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 654,
          "content": "///   `let x = foo`",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 655,
          "content": "///   `    .bar()`",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 656,
          "content": "///   `    .baz()`",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 657,
          "content": "///   `    .qux();`",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 658,
          "content": "///",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 659,
          "content": "/// Each individual line doesn't match the AI output, but when joined they do.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 660,
          "content": "fn improve_attributions_with_block_matching(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 661,
          "content": "    attributions: &mut [LineAttribution],",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 662,
          "content": "    history: &FileEditHistory,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 663,
          "content": ") {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 664,
          "content": "    if attributions.is_empty() || history.edits.is_empty() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 665,
          "content": "        return;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 666,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 667,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 668,
          "content": "    // Build normalized AI lines for comparison",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 669,
          "content": "    // We normalize each AI line and also create joined versions of consecutive AI lines",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 670,
          "content": "    let mut ai_normalized_lines: Vec<(String, String, u32)> = Vec::new(); // (normalized, edit_id, prompt_idx)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 671,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 672,
          "content": "    for edit in &history.edits {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 673,
          "content": "        for line in edit.after.content.lines() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 674,
          "content": "            let normalized = normalize_for_block_comparison(line);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 675,
          "content": "            if !normalized.is_empty() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 676,
          "content": "                ai_normalized_lines.push((normalized, edit.edit_id.clone(), edit.prompt_index));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 677,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 678,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 679,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 680,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 681,
          "content": "    // Also create joined versions of consecutive AI lines (2-8 lines joined)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 682,
          "content": "    for edit in &history.edits {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 683,
          "content": "        let lines: Vec<&str> = edit.after.content.lines().collect();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 684,
          "content": "        for window_size in 2..=8.min(lines.len()) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 685,
          "content": "            for start in 0..=lines.len().saturating_sub(window_size) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 686,
          "content": "                let joined: String = lines[start..start + window_size]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 687,
          "content": "                    .iter()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 688,
          "content": "                    .map(|l| normalize_for_block_comparison(l))",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 689,
          "content": "                    .collect::<Vec<_>>()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 690,
          "content": "                    .join(\" \");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 691,
          "content": "                if !joined.is_empty() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 692,
          "content": "                    ai_normalized_lines.push((joined, edit.edit_id.clone(), edit.prompt_index));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 693,
          "content": "                }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 694,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 695,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 696,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 697,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 698,
          "content": "    // Find blocks of consecutive unmatched lines (Human or low-confidence AIModified)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 699,
          "content": "    // Low-confidence AIModified lines are likely false positives from partial similarity matching",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 700,
          "content": "    let is_unmatched = |attr: &LineAttribution| -> bool {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 701,
          "content": "        match &attr.source {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 702,
          "content": "            LineSource::Human => true,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 703,
          "content": "            LineSource::Unknown => true,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 704,
          "content": "            // Include AIModified with similarity < 0.85 as potentially misattributed",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 705,
          "content": "            LineSource::AIModified { similarity, .. } => *similarity < 0.85,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 706,
          "content": "            _ => false,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 707,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 708,
          "content": "    };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 709,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 710,
          "content": "    let mut i = 0;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 711,
          "content": "    while i < attributions.len() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 712,
          "content": "        // Find start of an unmatched block",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 713,
          "content": "        if !is_unmatched(&attributions[i]) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 714,
          "content": "            i += 1;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 715,
          "content": "            continue;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 716,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 717,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 718,
          "content": "        // Find the extent of the unmatched block",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 719,
          "content": "        let block_start = i;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 720,
          "content": "        let mut block_end = i;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 721,
          "content": "        while block_end < attributions.len() && is_unmatched(&attributions[block_end]) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 722,
          "content": "            block_end += 1;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 723,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 724,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 725,
          "content": "        let block_len = block_end - block_start;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 726,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 727,
          "content": "        // Only process blocks of 1-8 lines",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 728,
          "content": "        if (1..=8).contains(&block_len) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 729,
          "content": "            // Join the block content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 730,
          "content": "            let block_content: String = attributions[block_start..block_end]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 731,
          "content": "                .iter()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 732,
          "content": "                .map(|a| normalize_for_block_comparison(&a.content))",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 733,
          "content": "                .collect::<Vec<_>>()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 734,
          "content": "                .join(\" \");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 735,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 736,
          "content": "            // Find best matching AI line/block",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 737,
          "content": "            let mut best_match: Option<(f64, String, u32)> = None;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 738,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 739,
          "content": "            for (ai_normalized, edit_id, prompt_idx) in &ai_normalized_lines {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 740,
          "content": "                let similarity = compute_similarity(&block_content, ai_normalized);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 741,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 742,
          "content": "                // Require similarity threshold based on block size",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 743,
          "content": "                // Lower thresholds because formatters can introduce small differences",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 744,
          "content": "                // (e.g., extra spaces, line breaks in different positions)",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 745,
          "content": "                let threshold = match block_len {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 746,
          "content": "                    1 => 0.75, // Single lines: might be partial match of split line",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 747,
          "content": "                    2 => 0.70, // Common case: one line split into two",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 748,
          "content": "                    3..=4 => 0.65,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 749,
          "content": "                    _ => 0.60,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 750,
          "content": "                };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 751,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 752,
          "content": "                if similarity >= threshold",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 753,
          "content": "                    && (best_match.is_none() || similarity > best_match.as_ref().unwrap().0)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 754,
          "content": "                {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 755,
          "content": "                    best_match = Some((similarity, edit_id.clone(), *prompt_idx));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 756,
          "content": "                }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 757,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 758,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 759,
          "content": "            // If we found a match, re-attribute all lines in the block",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 760,
          "content": "            if let Some((similarity, edit_id, prompt_idx)) = best_match {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 761,
          "content": "                for attr in attributions.iter_mut().take(block_end).skip(block_start) {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 762,
          "content": "                    attr.source = LineSource::AI {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 763,
          "content": "                        edit_id: edit_id.clone(),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 764,
          "content": "                    };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 765,
          "content": "                    attr.edit_id = Some(edit_id.clone());",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 766,
          "content": "                    attr.prompt_index = Some(prompt_idx);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 767,
          "content": "                    attr.confidence = similarity;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 768,
          "content": "                }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 769,
          "content": "            }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 770,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 771,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 772,
          "content": "        i = block_end;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 773,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 774,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 775,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 776,
          "content": "#[cfg(test)]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 777,
          "content": "mod tests {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 778,
          "content": "    use super::*;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 779,
          "content": "    use crate::capture::snapshot::AIEdit;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 780,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 781,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 782,
          "content": "    fn test_simple_ai_addition() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 783,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(\"line1\\nline2\\n\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 784,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 785,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 786,
          "content": "            \"Add line3\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 787,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 788,
          "content": "            \"Edit\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 789,
          "content": "            \"line1\\nline2\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 790,
          "content": "            \"line1\\nline2\\nline3\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 791,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 792,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 793,
          "content": "        let result = ThreeWayAnalyzer::analyze(&history, \"line1\\nline2\\nline3\\n\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 794,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 795,
          "content": "        // line1 and line2 exist in both original and AI output -> Original (unchanged)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 796,
          "content": "        // line3 is only in AI output -> AI (actually added by AI)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 797,
          "content": "        assert_eq!(result.summary.ai_lines, 1);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 798,
          "content": "        assert_eq!(result.summary.original_lines, 2);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 799,
          "content": "        assert_eq!(result.summary.human_lines, 0);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 800,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 801,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 802,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 803,
          "content": "    fn test_human_modification_after_ai() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 804,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(\"line1\\n\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 805,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 806,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 807,
          "content": "            \"Add lines\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 808,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 809,
          "content": "            \"Edit\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 810,
          "content": "            \"line1\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 811,
          "content": "            \"line1\\nAI line\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 812,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 813,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 814,
          "content": "        // Human adds a line and modifies AI line",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 815,
          "content": "        let final_content = \"line1\\nAI line modified\\nhuman line\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 816,
          "content": "        let result = ThreeWayAnalyzer::analyze(&history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 817,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 818,
          "content": "        // \"line1\" is in both original and AI output -> Original (unchanged)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 819,
          "content": "        assert_eq!(result.summary.original_lines, 1);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 820,
          "content": "        // \"AI line modified\" should be detected as AIModified (similar to \"AI line\")",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 821,
          "content": "        // \"human line\" should be detected as Human (not in original or AI)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 822,
          "content": "        assert_eq!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 823,
          "content": "            result.summary.ai_modified_lines + result.summary.human_lines,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 824,
          "content": "            2,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 825,
          "content": "            \"Should have 2 changed lines (modified + human)\"",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 826,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 827,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 828,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 829,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 830,
          "content": "    fn test_line_shift() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 831,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(\"line1\\nline2\\n\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 832,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 833,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 834,
          "content": "            \"Add AI content\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 835,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 836,
          "content": "            \"Edit\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 837,
          "content": "            \"line1\\nline2\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 838,
          "content": "            \"line1\\nline2\\nAI added\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 839,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 840,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 841,
          "content": "        // Human inserts line at beginning",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 842,
          "content": "        let final_content = \"new first line\\nline1\\nline2\\nAI added\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 843,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 844,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 845,
          "content": "        // \"new first line\" is Human (not in original or AI output)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 846,
          "content": "        // \"line1\", \"line2\" are in both original and AI output -> Original (unchanged)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 847,
          "content": "        // \"AI added\" is only in AI output -> AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 848,
          "content": "        assert_eq!(result.summary.human_lines, 1);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 849,
          "content": "        assert_eq!(result.summary.ai_lines, 1);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 850,
          "content": "        assert_eq!(result.summary.original_lines, 2);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 851,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 852,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 853,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 854,
          "content": "    fn test_similarity_computation() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 855,
          "content": "        assert_eq!(compute_similarity(\"hello\", \"hello\"), 1.0);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 856,
          "content": "        // Completely different strings",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 857,
          "content": "        assert!(compute_similarity(\"abc\", \"xyz\") < 0.3);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 858,
          "content": "        // Similar strings with comparable length should have high similarity",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 859,
          "content": "        assert!(compute_similarity(\"println(hello)\", \"println(world)\") > 0.6);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 860,
          "content": "        // Modified line detection",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 861,
          "content": "        assert!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 862,
          "content": "            compute_similarity(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 863,
          "content": "                \"    println!(\\\"hello\\\");\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 864,
          "content": "                \"    println!(\\\"hello, world!\\\");\"",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 865,
          "content": "            ) > 0.6",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 866,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 867,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 868,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 869,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 870,
          "content": "    fn test_multiple_ai_edits() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 871,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(\"original\\n\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 872,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 873,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 874,
          "content": "            \"First prompt\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 875,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 876,
          "content": "            \"Edit\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 877,
          "content": "            \"original\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 878,
          "content": "            \"original\\nfirst AI\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 879,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 880,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 881,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 882,
          "content": "            \"Second prompt\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 883,
          "content": "            1,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 884,
          "content": "            \"Edit\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 885,
          "content": "            \"original\\nfirst AI\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 886,
          "content": "            \"original\\nfirst AI\\nsecond AI\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 887,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 888,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 889,
          "content": "        let result = ThreeWayAnalyzer::analyze(&history, \"original\\nfirst AI\\nsecond AI\\n\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 890,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 891,
          "content": "        // \"original\" is in the original file AND in AI outputs -> Original (unchanged)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 892,
          "content": "        // \"first AI\" is NOT in original, added by AI -> AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 893,
          "content": "        // \"second AI\" is NOT in original, added by AI -> AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 894,
          "content": "        assert_eq!(result.summary.original_lines, 1);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 895,
          "content": "        assert_eq!(result.summary.ai_lines, 2);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 896,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 897,
          "content": "        // Check that AI lines have correct prompt indices",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 898,
          "content": "        let first_ai = result",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 899,
          "content": "            .lines",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 900,
          "content": "            .iter()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 901,
          "content": "            .find(|l| l.content == \"first AI\")",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 902,
          "content": "            .unwrap();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 903,
          "content": "        // first AI appears in edit 0's output and edit 1's output, later wins",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 904,
          "content": "        assert_eq!(first_ai.prompt_index, Some(1));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 905,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 906,
          "content": "        let second_ai = result",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 907,
          "content": "            .lines",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 908,
          "content": "            .iter()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 909,
          "content": "            .find(|l| l.content == \"second AI\")",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 910,
          "content": "            .unwrap();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 911,
          "content": "        assert_eq!(second_ai.prompt_index, Some(1));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 912,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 913,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 914,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 915,
          "content": "    fn test_only_original_no_ai_edits() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 916,
          "content": "        // Test that without AI edits, original lines stay original",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 917,
          "content": "        let history = FileEditHistory::new(\"test.rs\", Some(\"line1\\nline2\\n\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 918,
          "content": "        // No AI edits added",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 919,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 920,
          "content": "        let result = ThreeWayAnalyzer::analyze(&history, \"line1\\nline2\\nline3\\n\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 921,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 922,
          "content": "        // line1, line2 are original (no AI touched them)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 923,
          "content": "        // line3 is human (added without AI)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 924,
          "content": "        assert_eq!(result.summary.original_lines, 2);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 925,
          "content": "        assert_eq!(result.summary.human_lines, 1);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 926,
          "content": "        assert_eq!(result.summary.ai_lines, 0);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 927,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 928,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 929,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 930,
          "content": "    fn test_whitespace_normalization() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 931,
          "content": "        // Test that trailing whitespace differences don't affect attribution",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 932,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(\"\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 933,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 934,
          "content": "        // AI generates lines with trailing spaces",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 935,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 936,
          "content": "            \"Generate code\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 937,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 938,
          "content": "            \"Write\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 939,
          "content": "            \"\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 940,
          "content": "            \"fn main() {  \\n    println!(\\\"hello\\\");  \\n}\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 941,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 942,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 943,
          "content": "        // Final commit has trailing spaces stripped (common git behavior)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 944,
          "content": "        let final_content = \"fn main() {\\n    println!(\\\"hello\\\");\\n}\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 945,
          "content": "        let result = ThreeWayAnalyzer::analyze(&history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 946,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 947,
          "content": "        // All lines should be AI despite whitespace differences",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 948,
          "content": "        assert_eq!(result.summary.ai_lines, 3, \"All lines should be AI\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 949,
          "content": "        assert_eq!(result.summary.human_lines, 0, \"No human lines expected\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 950,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 951,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 952,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 953,
          "content": "    fn test_empty_line_attribution() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 954,
          "content": "        // Test that empty lines in AI output are properly attributed",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 955,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(\"\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 956,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 957,
          "content": "        // AI generates code with empty lines",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 958,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 959,
          "content": "            \"Generate code with spacing\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 960,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 961,
          "content": "            \"Write\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 962,
          "content": "            \"\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 963,
          "content": "            \"fn main() {\\n\\n    println!(\\\"hello\\\");\\n\\n}\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 964,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 965,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 966,
          "content": "        let final_content = \"fn main() {\\n\\n    println!(\\\"hello\\\");\\n\\n}\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 967,
          "content": "        let result = ThreeWayAnalyzer::analyze(&history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 968,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 969,
          "content": "        // All lines including empty ones should be AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 970,
          "content": "        assert_eq!(result.summary.ai_lines, 5, \"All 5 lines should be AI\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 971,
          "content": "        assert_eq!(result.summary.human_lines, 0, \"No human lines expected\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 972,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 973,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 974,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 975,
          "content": "    fn test_tabs_vs_spaces() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 976,
          "content": "        // Test that different indentation styles still match",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 977,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(\"\"));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 978,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 979,
          "content": "        // AI generates with spaces",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 980,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 981,
          "content": "            \"Generate code\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 982,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 983,
          "content": "            \"Write\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 984,
          "content": "            \"\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 985,
          "content": "            \"fn main() {\\n    code();\\n}\\n\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 986,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 987,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 988,
          "content": "        // Final uses same content (tabs would need different handling)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 989,
          "content": "        let final_content = \"fn main() {\\n    code();\\n}\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 990,
          "content": "        let result = ThreeWayAnalyzer::analyze(&history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 991,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 992,
          "content": "        assert_eq!(result.summary.ai_lines, 3);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 993,
          "content": "        assert_eq!(result.summary.human_lines, 0);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 994,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 995,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 996,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 997,
          "content": "    fn test_diff_unmapped_lines_still_attributed_correctly() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 998,
          "content": "        // This test verifies that lines existing in BOTH original and AI output are Original,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 999,
          "content": "        // while lines only in AI output are AI.",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1000,
          "content": "        let original = \"fn foo() {\\n    old_code();\\n}\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1001,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(original));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1002,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1003,
          "content": "        // AI rewrites the function with new content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1004,
          "content": "        // \"fn foo() {\" and \"}\" exist in both original and AI output",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1005,
          "content": "        let ai_output = \"fn foo() {\\n    new_code();\\n    more_code();\\n}\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1006,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1007,
          "content": "            \"Rewrite function\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1008,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1009,
          "content": "            \"Edit\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1010,
          "content": "            original,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1011,
          "content": "            ai_output,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1012,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1013,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1014,
          "content": "        // Final content matches AI output exactly",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1015,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, ai_output);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1016,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1017,
          "content": "        // Lines in both original AND AI output  Original (unchanged)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1018,
          "content": "        // \"fn foo() {\" and \"}\" are in both  2 Original",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1019,
          "content": "        // \"new_code();\" and \"more_code();\" are only in AI  2 AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1020,
          "content": "        assert_eq!(result.summary.ai_lines, 2, \"2 lines only in AI output\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1021,
          "content": "        assert_eq!(result.summary.human_lines, 0, \"No human lines expected\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1022,
          "content": "        assert_eq!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1023,
          "content": "            result.summary.original_lines, 2,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1024,
          "content": "            \"2 lines unchanged from original (fn foo and closing brace)\"",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1025,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1026,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1027,
          "content": "        // Verify the closing brace is Original (exists in both original and AI)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1028,
          "content": "        let closing_brace = result.lines.iter().find(|l| l.content == \"}\").unwrap();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1029,
          "content": "        assert!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1030,
          "content": "            matches!(closing_brace.source, LineSource::Original),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1031,
          "content": "            \"Closing brace should be Original (exists in both), got {:?}\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1032,
          "content": "            closing_brace.source",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1033,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1034,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1035,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1036,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1037,
          "content": "    fn test_debug_attribution_flow() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1038,
          "content": "        // Debug test to verify attribution logic",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1039,
          "content": "        let original = \"line1\\nline2\\nline3\\nline4\\nline5\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1040,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(original));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1041,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1042,
          "content": "        // First AI edit: adds line6, line7",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1043,
          "content": "        let after1 = \"line1\\nline2\\nline3\\nline4\\nline5\\nline6\\nline7\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1044,
          "content": "        history.add_edit(AIEdit::new(\"prompt1\", 0, \"Edit\", original, after1));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1045,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1046,
          "content": "        // Second AI edit: adds line8 and modifies line3",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1047,
          "content": "        let after2 = \"line1\\nline2\\nLINE3_MODIFIED\\nline4\\nline5\\nline6\\nline7\\nline8\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1048,
          "content": "        history.add_edit(AIEdit::new(\"prompt2\", 1, \"Edit\", after1, after2));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1049,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1050,
          "content": "        // Final content matches AI edit exactly",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1051,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, after2);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1052,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1053,
          "content": "        println!(\"\\nAttribution results:\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1054,
          "content": "        println!(\"  AI lines: {}\", result.summary.ai_lines);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1055,
          "content": "        println!(\"  AI modified lines: {}\", result.summary.ai_modified_lines);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1056,
          "content": "        println!(\"  Original lines: {}\", result.summary.original_lines);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1057,
          "content": "        println!(\"  Human lines: {}\", result.summary.human_lines);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1058,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1059,
          "content": "        for line in &result.lines {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1060,
          "content": "            println!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1061,
          "content": "                \"  Line {}: {:?} - '{}'\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1062,
          "content": "                line.line_number, line.source, line.content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1063,
          "content": "            );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1064,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1065,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1066,
          "content": "        // line1, line2, line4, line5: Original (unchanged from original)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1067,
          "content": "        // LINE3_MODIFIED: AI (this line was changed by AI)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1068,
          "content": "        // line6, line7, line8: AI (new lines added by AI)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1069,
          "content": "        assert_eq!(result.summary.ai_lines, 4, \"4 lines actually changed by AI\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1070,
          "content": "        assert_eq!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1071,
          "content": "            result.summary.original_lines, 4,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1072,
          "content": "            \"4 lines unchanged from original\"",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1073,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1074,
          "content": "        assert_eq!(result.summary.human_lines, 0, \"No human lines expected\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1075,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1076,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1077,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1078,
          "content": "    fn test_duplicate_lines_in_ai_output() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1079,
          "content": "        // Test that duplicate lines (like closing braces) are properly attributed",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1080,
          "content": "        // This tests the real-world scenario where the same line content appears multiple times",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1081,
          "content": "        let original = r#\"fn foo() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1082,
          "content": "    code();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1083,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1084,
          "content": "\"#;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1085,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(original));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1086,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1087,
          "content": "        // AI adds a new function with similar structure (duplicate \"}\" and empty lines)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1088,
          "content": "        let after1 = r#\"fn foo() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1089,
          "content": "    code();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1090,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1091,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1092,
          "content": "fn bar() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1093,
          "content": "    more_code();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1094,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1095,
          "content": "\"#;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1096,
          "content": "        history.add_edit(AIEdit::new(\"Add bar function\", 0, \"Edit\", original, after1));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1097,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1098,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, after1);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1099,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1100,
          "content": "        println!(\"\\nDuplicate lines test:\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1101,
          "content": "        for line in &result.lines {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1102,
          "content": "            let source_str = match &line.source {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1103,
          "content": "                LineSource::AI { .. } => \"AI\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1104,
          "content": "                LineSource::Original => \"Orig\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1105,
          "content": "                LineSource::Human => \"Human\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1106,
          "content": "                _ => \"Other\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1107,
          "content": "            };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1108,
          "content": "            println!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1109,
          "content": "                \"  Line {}: {} - '{}'\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1110,
          "content": "                line.line_number, source_str, line.content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1111,
          "content": "            );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1112,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1113,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1114,
          "content": "        // Lines 1-3 (fn foo, code(), }) exist in BOTH original and AI  Original",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1115,
          "content": "        // Lines 4-7 (empty, fn bar, more_code(), }) are only in AI  AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1116,
          "content": "        assert_eq!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1117,
          "content": "            result.summary.human_lines, 0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1118,
          "content": "            \"No human lines - all are either original or AI\"",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1119,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1120,
          "content": "        assert_eq!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1121,
          "content": "            result.summary.original_lines, 3,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1122,
          "content": "            \"3 lines unchanged from original (fn foo, code, first closing brace)\"",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1123,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1124,
          "content": "        assert_eq!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1125,
          "content": "            result.summary.ai_lines, 4,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1126,
          "content": "            \"4 lines added by AI (empty, fn bar, more_code, second closing brace)\"",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1127,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1128,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1129,
          "content": "        // The closing brace \"}\" appears twice:",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1130,
          "content": "        // - Line 3: from original (exists in both)  Original",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1131,
          "content": "        // - Line 7: added by AI (only in AI output)  AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1132,
          "content": "        let closing_braces: Vec<_> = result.lines.iter().filter(|l| l.content == \"}\").collect();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1133,
          "content": "        assert_eq!(closing_braces.len(), 2, \"Should have 2 closing braces\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1134,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1135,
          "content": "        // First closing brace (line 3) should be Original",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1136,
          "content": "        assert!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1137,
          "content": "            matches!(closing_braces[0].source, LineSource::Original),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1138,
          "content": "            \"First closing brace (line {}) should be Original, got {:?}\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1139,
          "content": "            closing_braces[0].line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1140,
          "content": "            closing_braces[0].source",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1141,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1142,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1143,
          "content": "        // Second closing brace (line 7) should be AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1144,
          "content": "        assert!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1145,
          "content": "            matches!(closing_braces[1].source, LineSource::AI { .. }),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1146,
          "content": "            \"Second closing brace (line {}) should be AI, got {:?}\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1147,
          "content": "            closing_braces[1].line_number,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1148,
          "content": "            closing_braces[1].source",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1149,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1150,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1151,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1152,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1153,
          "content": "    fn test_common_patterns_attributed_to_ai() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1154,
          "content": "        // Test that common patterns like empty lines, closing braces, and doc comments",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1155,
          "content": "        // are properly attributed to AI when they appear in AI output",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1156,
          "content": "        let original = \"\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1157,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(original));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1158,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1159,
          "content": "        // AI generates code with common patterns",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1160,
          "content": "        let ai_output = r#\"/// A test function",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1161,
          "content": "#[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1162,
          "content": "fn test() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1163,
          "content": "    assert!(true);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1164,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1165,
          "content": "\"#;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1166,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1167,
          "content": "            \"Generate test\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1168,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1169,
          "content": "            \"Write\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1170,
          "content": "            original,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1171,
          "content": "            ai_output,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1172,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1173,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1174,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, ai_output);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1175,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1176,
          "content": "        // All lines should be AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1177,
          "content": "        assert_eq!(result.summary.ai_lines, 5, \"All 5 lines should be AI\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1178,
          "content": "        assert_eq!(result.summary.human_lines, 0, \"No human lines\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1179,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1180,
          "content": "        // Check each line individually",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1181,
          "content": "        for line in &result.lines {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1182,
          "content": "            assert!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1183,
          "content": "                matches!(line.source, LineSource::AI { .. }),",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1184,
          "content": "                \"Line '{}' should be AI, got {:?}\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1185,
          "content": "                line.content,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1186,
          "content": "                line.source",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1187,
          "content": "            );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1188,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1189,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1190,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1191,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1192,
          "content": "    fn test_block_matching_reformatted_method_chain() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1193,
          "content": "        // Test that a method chain split by rustfmt is still attributed to AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1194,
          "content": "        let original = \"\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1195,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(original));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1196,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1197,
          "content": "        // AI generates a single-line method chain",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1198,
          "content": "        let ai_output = \"let result = foo.bar().baz().qux().unwrap();\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1199,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1200,
          "content": "            \"Generate code\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1201,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1202,
          "content": "            \"Write\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1203,
          "content": "            original,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1204,
          "content": "            ai_output,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1205,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1206,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1207,
          "content": "        // But the committed code has it split by rustfmt",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1208,
          "content": "        let final_content = r#\"let result = foo",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1209,
          "content": "    .bar()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1210,
          "content": "    .baz()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1211,
          "content": "    .qux()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1212,
          "content": "    .unwrap();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1213,
          "content": "\"#;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1214,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1215,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1216,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1217,
          "content": "        println!(\"\\nBlock matching test:\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1218,
          "content": "        for line in &result.lines {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1219,
          "content": "            let source_str = match &line.source {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1220,
          "content": "                LineSource::AI { .. } => \"AI\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1221,
          "content": "                LineSource::Human => \"Human\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1222,
          "content": "                _ => \"Other\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1223,
          "content": "            };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1224,
          "content": "            println!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1225,
          "content": "                \"  Line {}: {} - '{}'\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1226,
          "content": "                line.line_number, source_str, line.content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1227,
          "content": "            );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1228,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1229,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1230,
          "content": "        // All lines should be attributed to AI via block matching",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1231,
          "content": "        assert_eq!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1232,
          "content": "            result.summary.human_lines, 0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1233,
          "content": "            \"No human lines - block matching should attribute all to AI\"",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1234,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1235,
          "content": "        assert!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1236,
          "content": "            result.summary.ai_lines >= 4,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1237,
          "content": "            \"Most lines should be AI (got {})\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1238,
          "content": "            result.summary.ai_lines",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1239,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1240,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1241,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1242,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1243,
          "content": "    fn test_block_matching_split_assignment() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1244,
          "content": "        // Test an assignment split across two lines",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1245,
          "content": "        let original = \"\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1246,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(original));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1247,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1248,
          "content": "        // AI generates a single-line assignment",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1249,
          "content": "        let ai_output =",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1250,
          "content": "            \"let commit_time = DateTime::from_timestamp(commit.time().seconds(), 0).unwrap();\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1251,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1252,
          "content": "            \"Generate code\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1253,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1254,
          "content": "            \"Write\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1255,
          "content": "            original,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1256,
          "content": "            ai_output,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1257,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1258,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1259,
          "content": "        // But rustfmt splits it",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1260,
          "content": "        let final_content = r#\"let commit_time =",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1261,
          "content": "    DateTime::from_timestamp(commit.time().seconds(), 0).unwrap();",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1262,
          "content": "\"#;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1263,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1264,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1265,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1266,
          "content": "        println!(\"\\nSplit assignment test:\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1267,
          "content": "        for line in &result.lines {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1268,
          "content": "            let source_str = match &line.source {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1269,
          "content": "                LineSource::AI { .. } => \"AI\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1270,
          "content": "                LineSource::Human => \"Human\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1271,
          "content": "                LineSource::Original => \"Original\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1272,
          "content": "                LineSource::AIModified { .. } => \"AIModified\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1273,
          "content": "                LineSource::Unknown => \"Unknown\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1274,
          "content": "            };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1275,
          "content": "            println!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1276,
          "content": "                \"  Line {}: {} - '{}'\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1277,
          "content": "                line.line_number, source_str, line.content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1278,
          "content": "            );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1279,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1280,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1281,
          "content": "        // Both lines should be AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1282,
          "content": "        assert_eq!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1283,
          "content": "            result.summary.human_lines, 0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1284,
          "content": "            \"Both lines should be AI via block matching\"",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1285,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1286,
          "content": "        assert_eq!(result.summary.ai_lines, 2, \"Both lines should be AI\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1287,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1288,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1289,
          "content": "    #[test]",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1290,
          "content": "    fn test_block_matching_closure_formatting() {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1291,
          "content": "        // Test a closure that gets reformatted across multiple lines",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1292,
          "content": "        let original = \"\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1293,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(original));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1294,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1295,
          "content": "        // AI generates compact closure",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1296,
          "content": "        let ai_output = \".map(|t| { t.with_timezone(&Utc).format(\\\"%Y-%m-%d\\\").to_string() })\\n\";",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1297,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1298,
          "content": "            \"Generate code\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1299,
          "content": "            0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1300,
          "content": "            \"Write\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1301,
          "content": "            original,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1302,
          "content": "            ai_output,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1303,
          "content": "        ));",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1304,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1305,
          "content": "        // Rustfmt expands it",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1306,
          "content": "        let final_content = r#\".map(|t| {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1307,
          "content": "    t.with_timezone(&Utc)",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1308,
          "content": "        .format(\"%Y-%m-%d\")",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1309,
          "content": "        .to_string()",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1310,
          "content": "})",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1311,
          "content": "\"#;",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1312,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1313,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, final_content);",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1314,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1315,
          "content": "        println!(\"\\nClosure formatting test:\");",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1316,
          "content": "        for line in &result.lines {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1317,
          "content": "            let source_str = match &line.source {",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1318,
          "content": "                LineSource::AI { .. } => \"AI\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1319,
          "content": "                LineSource::Human => \"Human\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1320,
          "content": "                _ => \"Other\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1321,
          "content": "            };",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1322,
          "content": "            println!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1323,
          "content": "                \"  Line {}: {} - '{}'\",",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1324,
          "content": "                line.line_number, source_str, line.content",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1325,
          "content": "            );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1326,
          "content": "        }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1327,
          "content": "",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1328,
          "content": "        // All lines should be AI",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1329,
          "content": "        assert_eq!(",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1330,
          "content": "            result.summary.human_lines, 0,",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1331,
          "content": "            \"All lines should be AI via block matching\"",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1332,
          "content": "        );",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1333,
          "content": "    }",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        },
        {
          "line_number": 1334,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1335,
          "content": "    #[test]",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1336,
          "content": "    fn test_block_matching_ok_or_else_chain() {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1337,
          "content": "        // Test the pattern seen in setup.rs where rustfmt splits ok_or_else chains",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1338,
          "content": "        let original = \"\";",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1339,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(original));",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1340,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1341,
          "content": "        // AI generates a single-line ok_or_else call",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1342,
          "content": "        let ai_output = r#\"let hooks_dir = claude_hooks_dir().ok_or_else(|| anyhow::anyhow!(\"Could not determine home directory\"))?;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1343,
          "content": "\"#;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1344,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1345,
          "content": "            \"Generate code\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1346,
          "content": "            0,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1347,
          "content": "            \"Write\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1348,
          "content": "            original,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1349,
          "content": "            ai_output,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1350,
          "content": "        ));",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1351,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1352,
          "content": "        // rustfmt splits it into two lines",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1353,
          "content": "        let final_content = r#\"let hooks_dir =",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1354,
          "content": "    claude_hooks_dir().ok_or_else(|| anyhow::anyhow!(\"Could not determine home directory\"))?;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1355,
          "content": "\"#;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1356,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1357,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, final_content);",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1358,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1359,
          "content": "        println!(\"\\nok_or_else chain test:\");",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1360,
          "content": "        for line in &result.lines {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1361,
          "content": "            let source_str = match &line.source {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1362,
          "content": "                LineSource::AI { .. } => \"AI\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1363,
          "content": "                LineSource::Human => \"Human\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1364,
          "content": "                LineSource::AIModified { similarity, .. } => {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1365,
          "content": "                    &format!(\"AIModified({:.2})\", similarity)",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1366,
          "content": "                }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1367,
          "content": "                _ => \"Other\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1368,
          "content": "            };",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1369,
          "content": "            println!(",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1370,
          "content": "                \"  Line {}: {} - '{}'\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1371,
          "content": "                line.line_number, source_str, line.content",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1372,
          "content": "            );",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1373,
          "content": "        }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1374,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1375,
          "content": "        // Both lines should be AI via block matching",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1376,
          "content": "        assert_eq!(",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1377,
          "content": "            result.summary.human_lines, 0,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1378,
          "content": "            \"Both lines should be AI via block matching\"",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1379,
          "content": "        );",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1380,
          "content": "        assert_eq!(result.summary.ai_lines, 2, \"Both lines should be AI\");",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1381,
          "content": "    }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1382,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1383,
          "content": "    #[test]",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1384,
          "content": "    fn test_block_matching_sync_all_context() {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1385,
          "content": "        // Test pattern from audit.rs: file.sync_all().context(...)?",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1386,
          "content": "        let original = \"\";",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1387,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(original));",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1388,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1389,
          "content": "        // AI generates single line",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1390,
          "content": "        let ai_output = r#\"file.sync_all().context(\"Failed to sync audit log to disk\")?;",
          "source": {
            "type": "AIModified",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
            "similarity": 0.8
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 0.8
        },
        {
          "line_number": 1391,
          "content": "\"#;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1392,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1393,
          "content": "            \"Generate code\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1394,
          "content": "            0,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1395,
          "content": "            \"Write\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1396,
          "content": "            original,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1397,
          "content": "            ai_output,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1398,
          "content": "        ));",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1399,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1400,
          "content": "        // rustfmt splits it",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1401,
          "content": "        let final_content = r#\"file.sync_all()",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1402,
          "content": "    .context(\"Failed to sync audit log to disk\")?;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1403,
          "content": "\"#;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1404,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1405,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, final_content);",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1406,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1407,
          "content": "        println!(\"\\nsync_all().context() test:\");",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1408,
          "content": "        for line in &result.lines {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1409,
          "content": "            let source_str = match &line.source {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1410,
          "content": "                LineSource::AI { .. } => \"AI\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1411,
          "content": "                LineSource::Human => \"Human\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1412,
          "content": "                LineSource::AIModified { similarity, .. } => {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1413,
          "content": "                    &format!(\"AIModified({:.2})\", similarity)",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1414,
          "content": "                }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1415,
          "content": "                _ => \"Other\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1416,
          "content": "            };",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1417,
          "content": "            println!(",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1418,
          "content": "                \"  Line {}: {} - '{}'\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1419,
          "content": "                line.line_number, source_str, line.content",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1420,
          "content": "            );",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1421,
          "content": "        }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1422,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1423,
          "content": "        // Both lines should be AI",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1424,
          "content": "        assert_eq!(",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1425,
          "content": "            result.summary.human_lines, 0,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1426,
          "content": "            \"Both lines should be AI via block matching\"",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1427,
          "content": "        );",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1428,
          "content": "        assert_eq!(result.summary.ai_lines, 2, \"Both lines should be AI\");",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1429,
          "content": "    }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1430,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1431,
          "content": "    #[test]",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1432,
          "content": "    fn test_block_matching_assert_multiline() {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1433,
          "content": "        // Test pattern from redaction.rs: assert!() split across multiple lines",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1434,
          "content": "        let original = \"\";",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1435,
          "content": "        let mut history = FileEditHistory::new(\"test.rs\", Some(original));",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1436,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1437,
          "content": "        // AI generates single-line assert",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1438,
          "content": "        let ai_output = r#\"assert!(names.len() >= 22, \"Expected at least 22 builtin patterns, got {}\", names.len());",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1439,
          "content": "\"#;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1440,
          "content": "        history.add_edit(AIEdit::new(",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1441,
          "content": "            \"Generate code\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1442,
          "content": "            0,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1443,
          "content": "            \"Write\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1444,
          "content": "            original,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1445,
          "content": "            ai_output,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1446,
          "content": "        ));",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1447,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1448,
          "content": "        // rustfmt splits it across multiple lines",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1449,
          "content": "        let final_content = r#\"assert!(",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1450,
          "content": "    names.len() >= 22,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1451,
          "content": "    \"Expected at least 22 builtin patterns, got {}\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1452,
          "content": "    names.len()",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1453,
          "content": ");",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1454,
          "content": "\"#;",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1455,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1456,
          "content": "        let result = ThreeWayAnalyzer::analyze_with_diff(&history, final_content);",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1457,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1458,
          "content": "        println!(\"\\nmultiline assert test:\");",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1459,
          "content": "        for line in &result.lines {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1460,
          "content": "            let source_str = match &line.source {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1461,
          "content": "                LineSource::AI { .. } => \"AI\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1462,
          "content": "                LineSource::Human => \"Human\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1463,
          "content": "                LineSource::AIModified { similarity, .. } => {",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1464,
          "content": "                    &format!(\"AIModified({:.2})\", similarity)",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1465,
          "content": "                }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1466,
          "content": "                _ => \"Other\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1467,
          "content": "            };",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1468,
          "content": "            println!(",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1469,
          "content": "                \"  Line {}: {} - '{}'\",",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1470,
          "content": "                line.line_number, source_str, line.content",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1471,
          "content": "            );",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1472,
          "content": "        }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1473,
          "content": "",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1474,
          "content": "        // All 5 lines should be AI",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1475,
          "content": "        assert_eq!(",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1476,
          "content": "            result.summary.human_lines, 0,",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1477,
          "content": "            \"All lines should be AI via block matching\"",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1478,
          "content": "        );",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1479,
          "content": "        assert_eq!(result.summary.ai_lines, 5, \"All 5 lines should be AI\");",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1480,
          "content": "    }",
          "source": {
            "type": "AI",
            "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd"
          },
          "edit_id": "a658e868-9e47-452d-9ce3-5209cf9307cd",
          "prompt_index": 3,
          "confidence": 1.0
        },
        {
          "line_number": 1481,
          "content": "}",
          "source": {
            "type": "Original"
          },
          "edit_id": null,
          "prompt_index": null,
          "confidence": 1.0
        }
      ],
      "summary": {
        "total_lines": 1481,
        "ai_lines": 272,
        "ai_modified_lines": 1,
        "human_lines": 0,
        "original_lines": 1208,
        "unknown_lines": 0
      }
    }
  ]
}